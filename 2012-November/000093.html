<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiezatlas-svn] r109 - trunk/src/de/kiezatlas/deepamehta
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiezatlas-svn/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:kiezatlas-svn%40lists.berlios.de?Subject=Re%3A%20%5BKiezatlas-svn%5D%20r109%20-%20trunk/src/de/kiezatlas/deepamehta&In-Reply-To=%3C20121109134316.CA67555B0C%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000092.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiezatlas-svn] r109 - trunk/src/de/kiezatlas/deepamehta</H1>
    <B>maltito at scm.berlios.de</B> 
    <A HREF="mailto:kiezatlas-svn%40lists.berlios.de?Subject=Re%3A%20%5BKiezatlas-svn%5D%20r109%20-%20trunk/src/de/kiezatlas/deepamehta&In-Reply-To=%3C20121109134316.CA67555B0C%40scm.berlios.de%3E"
       TITLE="[Kiezatlas-svn] r109 - trunk/src/de/kiezatlas/deepamehta">maltito at scm.berlios.de
       </A><BR>
    <I>Fri Nov  9 14:43:16 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000092.html">[Kiezatlas-svn] r108 - in trunk: db/patches pages/be.de	src/de/kiezatlas/deepamehta src/de/kiezatlas/deepamehta/topics
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93">[ date ]</a>
              <a href="thread.html#93">[ thread ]</a>
              <a href="subject.html#93">[ subject ]</a>
              <a href="author.html#93">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: maltito
Date: 2012-11-09 14:43:16 +0100 (Fri, 09 Nov 2012)
New Revision: 109

Modified:
   trunk/src/de/kiezatlas/deepamehta/AtlasServlet.java
   trunk/src/de/kiezatlas/deepamehta/KiezAtlas.java
   trunk/src/de/kiezatlas/deepamehta/KiezServlet.java
   trunk/src/de/kiezatlas/deepamehta/MapServlet.java
Log:
Code Cleanup (pt.1):

Fixed indention in MapServlet, AtlasServlet., KiezServlet and KiezAtlas to real Tab's of size 4.
Fixed style of writing brackets in KiezServlet

Modified: trunk/src/de/kiezatlas/deepamehta/AtlasServlet.java
===================================================================
--- trunk/src/de/kiezatlas/deepamehta/AtlasServlet.java	2012-11-09 13:07:37 UTC (rev 108)
+++ trunk/src/de/kiezatlas/deepamehta/AtlasServlet.java	2012-11-09 13:43:16 UTC (rev 109)
@@ -40,153 +40,154 @@
 
 
 /**
- * Kiezatlas 1.6.7&lt;br&gt;
- * Requires DeepaMehta 2.0b8
+ * Kiezatlas 1.6.10&lt;br&gt;
+ * Requires DeepaMehta 2.0b8-rev388
  * &lt;p&gt;
- * Last change: 22.11.2010&lt;br&gt;
+ * Last change: 09.11.2012&lt;br&gt;
  * Malte Rei&szlig;ig &lt;br&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/kiezatlas-svn">mre at deepamehta.de</A>
+ * &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiezatlas-svn">mre at deepamehta.de</A>&gt;
  */
 public class AtlasServlet extends DeepaMehtaServlet implements KiezAtlas {
 
-  
 
-    // --
-    // --- KiezAtlas Service Settings / berlin.de City Map Servlet
-    // --
 
+	// --
+	// --- KiezAtlas Service Settings / berlin.de City Map Servlet
+	// --
 
 
-    // private final String urlStr = &quot;<A HREF="http://www.kiezatlas.de/rpc/">http://www.kiezatlas.de/rpc/</A>&quot;;
-    private final String urlStr = &quot;<A HREF="http://localhost:8080/kiezatlas/rpc/">http://localhost:8080/kiezatlas/rpc/</A>&quot;;
-    private final String charset = &quot;ISO-8859-1&quot;;
-    String topicmapId = &quot;&quot;;
 
+	// private final String urlStr = &quot;<A HREF="http://www.kiezatlas.de/rpc/">http://www.kiezatlas.de/rpc/</A>&quot;;
+	private final String urlStr = &quot;<A HREF="http://localhost:8080/kiezatlas/rpc/">http://localhost:8080/kiezatlas/rpc/</A>&quot;;
+	private final String charset = &quot;ISO-8859-1&quot;;
 
+	String topicmapId = &quot;is-set-to-current-topicmap-id-of-request&quot;; // used by new getLastModified impl
 
-	protected String performAction(String action, RequestParameter params, Session session, CorporateDirectives directives)
-																									throws ServletException {
+
+
+	protected String performAction(String action, RequestParameter params, Session session, 
+									CorporateDirectives directives) throws ServletException {
 		if (action == null) {
-            try {
-                String pathInfo = params.getPathInfo();
-                // error check
-                if (pathInfo == null || pathInfo.length() == 1) {
-                    throw new DeepaMehtaException(&quot;Fehler in URL&quot;);
-                }
-                String[] elements = pathInfo.split(&quot;/&quot;);
-                Hashtable requested = parseRequestedPath(elements);
-                if (requested != null) {
-                    session.setAttribute(&quot;originId&quot;, requested.get(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
-                    session.setAttribute(&quot;topicId&quot;, requested.get(&quot;geo&quot;));
-                    session.setAttribute(&quot;categories&quot;, requested.get(&quot;categories&quot;));
-                    session.setAttribute(&quot;baseLayer&quot;, requested.get(&quot;layer&quot;));
-                    session.setAttribute(&quot;critIndex&quot;, requested.get(&quot;criteria&quot;));
-                    session.setAttribute(&quot;searchTerm&quot;, requested.get(&quot;search&quot;));
-                }
-                // overrides pathinfo url settings just parsed.. for backwards compatibility reasons
-                // application states represented in URL - just passing params to javascript
-                Integer critIndex = 0;
-                if (params.getParameter(&quot;critId&quot;) != null) {
-                    critIndex = Integer.parseInt(params.getParameter(&quot;critId&quot;))-1;
-                } // [0]
-                if (params.getParameter(&quot;linkTo&quot;) != null) session.setAttribute(&quot;originId&quot;, params.getParameter(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
-                if (params.getParameter(&quot;topicId&quot;) != null) session.setAttribute(&quot;topicId&quot;, params.getParameter(&quot;topicId&quot;));
-                if (params.getParameter(&quot;catIds&quot;) != null) session.setAttribute(&quot;categories&quot;, params.getParameter(&quot;catIds&quot;));
-                if (params.getParameter(&quot;baseLayer&quot;) != null) session.setAttribute(&quot;baseLayer&quot;, params.getParameter(&quot;baseLayer&quot;));
-                if (params.getParameter(&quot;search&quot;) != null) session.setAttribute(&quot;searchTerm&quot;, params.getParameter(&quot;search&quot;));
-                if (session.getAttribute(&quot;critIndex&quot;) == null) session.setAttribute(&quot;critIndex&quot;, critIndex);
-                //
-                String alias = pathInfo.substring(1);
-                if (pathInfo.indexOf(&quot;&amp;&quot;) != -1) {
-                    alias = pathInfo.substring(1, pathInfo.indexOf(&quot;&amp;&quot;));
-                } else if (pathInfo.indexOf(&quot;/&quot;, 1) != -1) {
-                    // if / behind mapname... slice map-alias out
-                    alias = elements[1];
-                }
-                session.setAttribute(&quot;mapAlias&quot;, alias);
-                BaseTopic mapTopic = CityMapTopic.lookupCityMap(alias, true, as); // throwIfNotFound=true
-                setCityMap(mapTopic, session);
-                if (!CityMapTopic.isProtected(mapTopic, as)) {
-                    //
-                    initCityMap(session);
-                    return PAGE_BERLIN_ATLAS;
-                } else {
-                    return PAGE_MAP_LOGIN;
-                }
-            } catch (DeepaMehtaException e) {
-                System.out.println(&quot;*** BrowseServlet.performAction(): &quot; + e);
-                session.setAttribute(&quot;error&quot;, e.getMessage());
-                return PAGE_ERROR;
-            }
-        }
+			try {
+				String pathInfo = params.getPathInfo();
+				// error check
+				if (pathInfo == null || pathInfo.length() == 1) {
+					throw new DeepaMehtaException(&quot;Fehler in URL&quot;);
+				}
+				String[] elements = pathInfo.split(&quot;/&quot;);
+				Hashtable requested = parseRequestedPath(elements);
+				if (requested != null) {
+					session.setAttribute(&quot;originId&quot;, requested.get(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
+					session.setAttribute(&quot;topicId&quot;, requested.get(&quot;geo&quot;));
+					session.setAttribute(&quot;categories&quot;, requested.get(&quot;categories&quot;));
+					session.setAttribute(&quot;baseLayer&quot;, requested.get(&quot;layer&quot;));
+					session.setAttribute(&quot;critIndex&quot;, requested.get(&quot;criteria&quot;));
+					session.setAttribute(&quot;searchTerm&quot;, requested.get(&quot;search&quot;));
+				}
+				// overrides pathinfo url settings just parsed.. for backwards compatibility reasons
+				// application states represented in URL - just passing params to javascript
+				Integer critIndex = 0;
+				if (params.getParameter(&quot;critId&quot;) != null) {
+					critIndex = Integer.parseInt(params.getParameter(&quot;critId&quot;))-1;
+				} // [0]
+				if (params.getParameter(&quot;linkTo&quot;) != null) session.setAttribute(&quot;originId&quot;, params.getParameter(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
+				if (params.getParameter(&quot;topicId&quot;) != null) session.setAttribute(&quot;topicId&quot;, params.getParameter(&quot;topicId&quot;));
+				if (params.getParameter(&quot;catIds&quot;) != null) session.setAttribute(&quot;categories&quot;, params.getParameter(&quot;catIds&quot;));
+				if (params.getParameter(&quot;baseLayer&quot;) != null) session.setAttribute(&quot;baseLayer&quot;, params.getParameter(&quot;baseLayer&quot;));
+				if (params.getParameter(&quot;search&quot;) != null) session.setAttribute(&quot;searchTerm&quot;, params.getParameter(&quot;search&quot;));
+				if (session.getAttribute(&quot;critIndex&quot;) == null) session.setAttribute(&quot;critIndex&quot;, critIndex);
+				//
+				String alias = pathInfo.substring(1);
+				if (pathInfo.indexOf(&quot;&amp;&quot;) != -1) {
+					alias = pathInfo.substring(1, pathInfo.indexOf(&quot;&amp;&quot;));
+				} else if (pathInfo.indexOf(&quot;/&quot;, 1) != -1) {
+					// if / behind mapname... slice map-alias out
+					alias = elements[1];
+				}
+				session.setAttribute(&quot;mapAlias&quot;, alias);
+				BaseTopic mapTopic = CityMapTopic.lookupCityMap(alias, true, as); // throwIfNotFound=true
+				setCityMap(mapTopic, session);
+				if (!CityMapTopic.isProtected(mapTopic, as)) {
+					//
+					initCityMap(session);
+					return PAGE_BERLIN_ATLAS;
+				} else {
+					return PAGE_MAP_LOGIN;
+				}
+			} catch (DeepaMehtaException e) {
+				System.out.println(&quot;*** BrowseServlet.performAction(): &quot; + e);
+				session.setAttribute(&quot;error&quot;, e.getMessage());
+				return PAGE_ERROR;
+			}
+		}
 
-        // session timeout?
-        if (getCityMap(session) == null) {
-            System.out.println(&quot;*** Session Expired ***&quot;);
-            session.setAttribute(&quot;error&quot;, &quot;Timeout: Kiezatlas wurde mehr als &quot; +
-                ((WebSession) session).session.getMaxInactiveInterval() / 60 + &quot; Minuten nicht benutzt&quot;);
-            return PAGE_ERROR;
-        }
+		// session timeout?
+		if (getCityMap(session) == null) {
+			System.out.println(&quot;*** Session Expired ***&quot;);
+			session.setAttribute(&quot;error&quot;, &quot;Timeout: Kiezatlas wurde mehr als &quot; +
+				((WebSession) session).session.getMaxInactiveInterval() / 60 + &quot; Minuten nicht benutzt&quot;);
+			return PAGE_ERROR;
+		}
 
-        // login
-        if (action.equals(ACTION_TRY_LOGIN)) {
-            String password = params.getValue(&quot;password&quot;);
-            if (CityMapTopic.passwordCorrect(getCityMap(session), as, password)) {
-                initCityMap(session);
-                return PAGE_BERLIN_ATLAS;
-            } else {
-                return PAGE_MAP_LOGIN;
-            }
-        } else if (action.equals(ACTION_SEARCH)) {
-            // search
-            setSearchMode(SEARCHMODE_BY_NAME, session);
-            setSearchValue(params.getValue(&quot;search&quot;), session);
-            return PAGE_GEO_LIST;
-        // show
-        } else if (action.equals(ACTION_SHOW_CATEGORIES)) {
-            String critNr = params.getValue(&quot;critNr&quot;);
-            setSearchMode(critNr, session);
-            session.setAttribute(&quot;defaultCriteria&quot;, critNr);
-            return PAGE_CATEGORY_LIST;
-        // select
-        } else if (action.equals(ACTION_SELECT_CATEGORY)) {
-            Vector selCats = getSelectedCats(session);
-            String catID = params.getValue(&quot;id&quot;);
-            toggle(selCats, catID);
-            return PAGE_CATEGORY_LIST;
-        // search by
-        } else if (action.equals(ACTION_SEARCH_BY_CATEGORY)) {
-            // needed for &quot;cross-links&quot; ### criterias in geo info are not rendered as links anymore
-            String critNr = params.getValue(&quot;critNr&quot;);
-            if (critNr != null) {
-                setSearchMode(critNr, session);
-            }
-            //
-            String catID = params.getValue(&quot;id&quot;);
-            setSearchValue(as.getLiveTopic(catID, 1).getName(), session);
-            // ### setSearchMode(SEARCHMODE_BY_CATEGORY, session);		// needed for &quot;cross-links&quot;
-            Vector selCats = getSelectedCats(session);
-            switchOn(selCats, catID);
-            return PAGE_GEO_LIST;
-        // info
-        } else if (action.equals(ACTION_SHOW_GEO_INFO)) {
-        // ### should also set the current HotspotMarker (e.g. after searchByCategory)
-                String geoID = params.getValue(&quot;id&quot;);
-            setSelectedGeo(geoID, session);
-            TopicBean topicBean = as.createTopicBean(geoID, 1);
-            session.setAttribute(&quot;topicBean&quot;, topicBean);
-            String imagePath = as.getCorporateWebBaseURL() + FILESERVER_IMAGES_PATH;
-            session.setAttribute(&quot;imagePath&quot;, imagePath);
-            GeoObjectTopic geo = (GeoObjectTopic) as.getLiveTopic(geoID, 1);
-            boolean isForumActivated = geo.isForumActivated();
-            session.setAttribute(&quot;forumActivition&quot;, isForumActivated ? SWITCH_ON : SWITCH_OFF);
-            if (isForumActivated) {
-                session.setAttribute(&quot;commentCount&quot;, new Integer(geo.getComments().size()));
-            }
-            return PAGE_GEO_INFO;
-            // show forum if wanted
-        }
-        return PAGE_ERROR;
+		// login
+		if (action.equals(ACTION_TRY_LOGIN)) {
+			String password = params.getValue(&quot;password&quot;);
+			if (CityMapTopic.passwordCorrect(getCityMap(session), as, password)) {
+				initCityMap(session);
+				return PAGE_BERLIN_ATLAS;
+			} else {
+				return PAGE_MAP_LOGIN;
+			}
+		} else if (action.equals(ACTION_SEARCH)) {
+			// search
+			setSearchMode(SEARCHMODE_BY_NAME, session);
+			setSearchValue(params.getValue(&quot;search&quot;), session);
+			return PAGE_GEO_LIST;
+		// show
+		} else if (action.equals(ACTION_SHOW_CATEGORIES)) {
+			String critNr = params.getValue(&quot;critNr&quot;);
+			setSearchMode(critNr, session);
+			session.setAttribute(&quot;defaultCriteria&quot;, critNr);
+			return PAGE_CATEGORY_LIST;
+		// select
+		} else if (action.equals(ACTION_SELECT_CATEGORY)) {
+			Vector selCats = getSelectedCats(session);
+			String catID = params.getValue(&quot;id&quot;);
+			toggle(selCats, catID);
+			return PAGE_CATEGORY_LIST;
+		// search by
+		} else if (action.equals(ACTION_SEARCH_BY_CATEGORY)) {
+			// needed for &quot;cross-links&quot; ### criterias in geo info are not rendered as links anymore
+			String critNr = params.getValue(&quot;critNr&quot;);
+			if (critNr != null) {
+				setSearchMode(critNr, session);
+			}
+			//
+			String catID = params.getValue(&quot;id&quot;);
+			setSearchValue(as.getLiveTopic(catID, 1).getName(), session);
+			// ### setSearchMode(SEARCHMODE_BY_CATEGORY, session);		// needed for &quot;cross-links&quot;
+			Vector selCats = getSelectedCats(session);
+			switchOn(selCats, catID);
+			return PAGE_GEO_LIST;
+		// info
+		} else if (action.equals(ACTION_SHOW_GEO_INFO)) {
+		// ### should also set the current HotspotMarker (e.g. after searchByCategory)
+			String geoID = params.getValue(&quot;id&quot;);
+			setSelectedGeo(geoID, session);
+			TopicBean topicBean = as.createTopicBean(geoID, 1);
+			session.setAttribute(&quot;topicBean&quot;, topicBean);
+			String imagePath = as.getCorporateWebBaseURL() + FILESERVER_IMAGES_PATH;
+			session.setAttribute(&quot;imagePath&quot;, imagePath);
+			GeoObjectTopic geo = (GeoObjectTopic) as.getLiveTopic(geoID, 1);
+			boolean isForumActivated = geo.isForumActivated();
+			session.setAttribute(&quot;forumActivition&quot;, isForumActivated ? SWITCH_ON : SWITCH_OFF);
+			if (isForumActivated) {
+				session.setAttribute(&quot;commentCount&quot;, new Integer(geo.getComments().size()));
+			}
+			return PAGE_GEO_INFO;
+			// show forum if wanted
+		}
+		return PAGE_ERROR;
     }
 
     protected void preparePage(String page, RequestParameter params, Session session, CorporateDirectives directives) {
@@ -195,8 +196,8 @@
 			Vector selectedCats = getSelectedCats(session);
 			session.setAttribute(&quot;categories&quot;, categories);
 			session.setAttribute(&quot;selectedCats&quot;, selectedCats);
-      // disable enumeration rendering
-      session.setAttribute(&quot;enumerationFlag&quot;, false);
+			// disable enumeration rendering
+			session.setAttribute(&quot;enumerationFlag&quot;, false);
 			// hotspots
 			setCategoryHotspots(session);
 			// clear marker
@@ -207,19 +208,19 @@
 			String instTypeID = getInstitutionType(session).getID();
 			String searchMode = getSearchMode(session);
 			Vector insts;
-            // enable the rendering of enumeration
-            session.setAttribute(&quot;enumerationFlag&quot;, true);
+			// enable the rendering of enumeration
+			session.setAttribute(&quot;enumerationFlag&quot;, true);
 			if (searchMode.equals(SEARCHMODE_BY_NAME)) {
 				insts = cm.getViewTopics(mapID, 1, instTypeID, getSearchValue(session));
 				// hotspots
 				setHotspots(insts, ICON_HOTSPOT, session);
-                session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;);
+				session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;);
 			} else {
 				String catID = params.getValue(&quot;id&quot;);
 				insts = cm.getRelatedViewTopics(mapID, 1, catID, ASSOCTYPE_ASSOCIATION, instTypeID, 1);	// ### copy in setCategoryHotspots()
 				// hotspots + return the index of the current CatID in the multi-dimensional hotspot vector
 				int catIndex = setSearchedCategoryHotspots(session, catID);
-                session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;+catIndex+&quot;&quot;);
+				session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;+catIndex+&quot;&quot;);
 			}
 			session.setAttribute(&quot;institutions&quot;, insts);
 			// categories &amp; addresses
@@ -251,108 +252,110 @@
 			session.setAttribute(&quot;geoComments&quot;, getSelectedGeo(session).getCommentBeans());
 		}
 	}
-    
-    protected long getLastModified(HttpServletRequest req) {
-        String dateProperty = as.getTopicProperty(this.topicmapId, 1, PROPERTY_LAST_UPDATED);
-        long lastModified = new Date().getTime();
-        if (!dateProperty.equals(&quot;&quot;)) lastModified = new Date(Long.parseLong(dateProperty)).getTime();
-        return lastModified;
-    }
 
+	protected long getLastModified(HttpServletRequest req) {
+		String dateProperty = as.getTopicProperty(this.topicmapId, 1, PROPERTY_LAST_UPDATED);
+		long lastModified = new Date().getTime();
+		if (!dateProperty.equals(&quot;&quot;)) lastModified = new Date(Long.parseLong(dateProperty)).getTime();
+		return lastModified;
+	}
 
-  
+
+
 	// *****************
 	// *** Utilities ***
 	// *****************
 
-  private String getMapTopics(String mapId, String workspaceId, Session session) {
-    String result = null;
-    try {
-        // Send data
-        URL url = new URL(urlStr);
-        String query = &quot;{\&quot;method\&quot;: \&quot;getMapTopics\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot; , \&quot;&quot; + workspaceId + &quot;\&quot;]}&quot;;
-        URLConnection connection = new URL(urlStr).openConnection();
-        connection.setDoOutput(true); // Triggers POST.
-        // connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
-        connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
-        OutputStream output = null;
-        output = connection.getOutputStream();
-        output.write(query.getBytes(charset));
-        // Get the response
-        BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
-        String line = &quot;&quot;;
-        if (rd.ready()) {
-          line = rd.readLine();
-        }
-        result = line;
-        rd.close();
-        return result;
-    } catch(UnknownHostException uke) {
-        System.out.println(&quot;*** [ATLAS] could not load CityMap-Data from &quot; + urlStr + &quot; cause is: &quot; + uke.getCause());
-        return null;
-        // done();
-    } catch (Exception ex) {
-        System.out.println(&quot;*** [ATLAS] Servletencountered problem: &quot; + ex.getMessage());
-        return null;
-    }
-  }
+	private String getMapTopics(String mapId, String workspaceId, Session session) {
+		String result = null;
+		try {
+			// Send data
+			URL url = new URL(urlStr);
+			String query = &quot;{\&quot;method\&quot;: \&quot;getMapTopics\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot; , \&quot;&quot; + workspaceId + &quot;\&quot;]}&quot;;
+			URLConnection connection = new URL(urlStr).openConnection();
+			connection.setDoOutput(true); // Triggers POST.
+			// connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
+			OutputStream output = null;
+			output = connection.getOutputStream();
+			output.write(query.getBytes(charset));
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
+			String line = &quot;&quot;;
+			if (rd.ready()) {
+				line = rd.readLine();
+			}
+			result = line;
+			rd.close();
+			return result;
+		} catch(UnknownHostException uke) {
+			System.out.println(&quot;*** [ATLAS] couldn't load CityMapData from &quot; + urlStr + &quot; cause is: &quot; + uke.getCause());
+			return null;
+			// done();
+		} catch (Exception ex) {
+			System.out.println(&quot;*** [ATLAS] Servletencountered problem: &quot; + ex.getMessage());
+			return null;
+		}
+	}
 
-  private String getKiezCriterias(String mapId, Session session) {
-    String result = null;
-    try {
-        // Send data
-        URL url = new URL(urlStr);
-        String query = &quot;{\&quot;method\&quot;: \&quot;getWorkspaceCriterias\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot;]}&quot;;
-        // url.s
-        URLConnection connection = new URL(urlStr).openConnection();
-        connection.setDoOutput(true); // Triggers POST.
-        // connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
-        connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
-        OutputStream output = null;
-        output = connection.getOutputStream();
-        output.write(query.getBytes(charset));
-        // Get the response
-        BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
-        String line = &quot;&quot;;
-        if (rd.ready()) {
-          line = rd.readLine();
-        }
-        result = line;
-        return result;
-    } catch(UnknownHostException uke) {
-        System.out.println(&quot;*** [ATLAS] could not load CityMap-Data from &quot; + urlStr + &quot; message is: &quot; + uke.getCause());
-        return null;
-        // done();
-    } catch (UnsupportedEncodingException ex) {
-        System.out.println(&quot;*** [AtlasServlet] Servlet encountered unsupportedEncoding : &quot; + ex.getMessage());
-        return null;
-    } catch (IOException ex) {
-        System.out.println(&quot;*** [AtlasServlet] Servlet encountered ioException : &quot; + ex.getMessage());
-        return null;
-    }
-  }
+	private String getKiezCriterias(String mapId, Session session) {
+		String result = null;
+		try {
+			// Send data
+			URL url = new URL(urlStr);
+			String query = &quot;{\&quot;method\&quot;: \&quot;getWorkspaceCriterias\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot;]}&quot;;
+			// url.s
+			URLConnection connection = new URL(urlStr).openConnection();
+			connection.setDoOutput(true); // Triggers POST.
+			// connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
+			OutputStream output = null;
+			output = connection.getOutputStream();
+			output.write(query.getBytes(charset));
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
+			String line = &quot;&quot;;
+			if (rd.ready()) {
+				line = rd.readLine();
+			}
+			result = line;
+			return result;
+		} catch(UnknownHostException uke) {
+			System.out.println(&quot;*** [ATLAS] could not load CityMap-Data from &quot; + urlStr + &quot; message is: &quot; + uke.getCause());
+			return null;
+			// done();
+		} catch (UnsupportedEncodingException ex) {
+			System.out.println(&quot;*** [AtlasServlet] Servlet encountered unsupportedEncoding : &quot; + ex.getMessage());
+			return null;
+		} catch (IOException ex) {
+			System.out.println(&quot;*** [AtlasServlet] Servlet encountered ioException : &quot; + ex.getMessage());
+			return null;
+		}
+	}
 
-  private String getWorkspaceHomepage(String workspaceId, Session session) {
-    String homepageURL = &quot;&quot;;
-    //
-    BaseTopic homepage = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK, TOPICTYPE_WEBPAGE, 2, true);
-    if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
-    return homepageURL;
-  }
+	private String getWorkspaceHomepage(String workspaceId, Session session) {
+		String homepageURL = &quot;&quot;;
+		//
+		BaseTopic homepage = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK,
+				TOPICTYPE_WEBPAGE, 2, true);
+		if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
+		return homepageURL;
+	}
 
-  private String getWorkspaceImprint(String workspaceId, Session session) {
-    String impressumURL = &quot;&quot;;
-    BaseTopic impressum = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, TOPICTYPE_WEBPAGE, 2, true);
-    if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
-    return impressumURL;
-  }
+	private String getWorkspaceImprint(String workspaceId, Session session) {
+		String impressumURL = &quot;&quot;;
+		BaseTopic impressum = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, 
+				TOPICTYPE_WEBPAGE, 2, true);
+		if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
+		return impressumURL;
+	}
 
-  private String getWorkspaceLogo(String workspaceId, Session session) {
-    String logoURL = &quot;&quot;;
-    BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
-    if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
-    return logoURL;
-  }
+	private String getWorkspaceLogo(String workspaceId, Session session) {
+		String logoURL = &quot;&quot;;
+		BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
+		if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
+		return logoURL;
+	}
 
 	private void toggle(Vector topicIDs, String topicID) {
 		if (topicIDs.contains(topicID)) {
@@ -424,20 +427,20 @@
 
 	// --- Methods to maintain data in the session
 
-  private void initCityMap(Session session) {
-    //
-    BaseTopic map = getCityMap(session);
-    BaseTopic workspace = as.getTopicmapOwner(map.getID());
-    session.setAttribute(&quot;workspace&quot;, workspace);
-    String mapTopics = getMapTopics(map.getID(), workspace.getID(), session);
-    String workspaceCriterias = getKiezCriterias(map.getID(), session);
-    // String workspaceInfos = getWorkspaceInfos(workspaceId, session);
-    session.setAttribute(&quot;mapTopics&quot;, mapTopics);
-    session.setAttribute(&quot;workspaceCriterias&quot;, workspaceCriterias);
-    session.setAttribute(&quot;workspaceImprint&quot;, getWorkspaceImprint(workspace.getID(), session));
-    session.setAttribute(&quot;workspaceHomepage&quot;, getWorkspaceHomepage(workspace.getID(), session));
-    session.setAttribute(&quot;workspaceLogo&quot;, getWorkspaceLogo(workspace.getID(), session));
-  }
+	private void initCityMap(Session session) {
+		//
+		BaseTopic map = getCityMap(session);
+		BaseTopic workspace = as.getTopicmapOwner(map.getID());
+		session.setAttribute(&quot;workspace&quot;, workspace);
+		String mapTopics = getMapTopics(map.getID(), workspace.getID(), session);
+		String workspaceCriterias = getKiezCriterias(map.getID(), session);
+		// String workspaceInfos = getWorkspaceInfos(workspaceId, session);
+		session.setAttribute(&quot;mapTopics&quot;, mapTopics);
+		session.setAttribute(&quot;workspaceCriterias&quot;, workspaceCriterias);
+		session.setAttribute(&quot;workspaceImprint&quot;, getWorkspaceImprint(workspace.getID(), session));
+		session.setAttribute(&quot;workspaceHomepage&quot;, getWorkspaceHomepage(workspace.getID(), session));
+		session.setAttribute(&quot;workspaceLogo&quot;, getWorkspaceLogo(workspace.getID(), session));
+	}
 
 	private void setCityMap(BaseTopic map, Session session) {
 		String mapImage = as.getCorporateWebBaseURL() + FILESERVER_BACKGROUNDS_PATH +
@@ -565,10 +568,10 @@
 		System.out.println(&quot;&gt; \&quot;hotspots\&quot; stored in session: institutions for &quot; + selCats.size() + &quot; categories&quot;);
 	}
 
-    /**
-     * nearly the same to setCategoryHotspots, except that it
-     * takes a catID as an argument and returns it index in the enumeration
-     */
+	/**
+	 * nearly the same to setCategoryHotspots, except that it
+	 * takes a catID as an argument and returns it index in the enumeration
+	 */
 	private int setSearchedCategoryHotspots(Session session, String catId) {
 		String mapID = getCityMap(session).getID();
 		String instTypeID = getInstitutionType(session).getID();
@@ -577,11 +580,11 @@
 		Vector hotspots = new Vector();
 		Vector cluster = new Vector();
 		Enumeration e = selCats.elements();
-        int catIndex = 0;
-        int finalCatIndex = 0;
+		int catIndex = 0;
+		int finalCatIndex = 0;
 		while (e.hasMoreElements()) {
 			String catID = (String) e.nextElement();
-            if (catId == catID) { finalCatIndex = catIndex; };
+			if (catId == catID) { finalCatIndex = catIndex; };
 			Vector presentables = cm.getRelatedViewTopics(mapID, 1, catID, ASSOCTYPE_ASSOCIATION, instTypeID, 1);
 			String icon;
 			if (getSearchMode(session).equals(&quot;0&quot;)) {	// ### first search criteria uses distinct visualization
@@ -594,13 +597,13 @@
 			}
 			presentables.insertElementAt(as.getCorporateWebBaseURL() + FILESERVER_ICONS_PATH + icon, 0);
 			hotspots.addElement(presentables);
-            catIndex++;
+			catIndex++;
 		}
 		makeCluster(hotspots, cluster);
 		session.setAttribute(&quot;cluster&quot;, cluster);
 		session.setAttribute(&quot;hotspots&quot;, hotspots);
 		System.out.println(&quot;&gt; \&quot;hotspots\&quot; stored in session: institutions for &quot; + selCats.size() + &quot; categories&quot;);
-        return finalCatIndex;
+		return finalCatIndex;
 	}
 
 	// ---
@@ -655,42 +658,40 @@
 					}
 				}
 			}
-			// ### System.out.println(&quot;&gt; \&quot;clusters\&quot;: &quot;+clusters.toString());
 		}
-        //removeClusteredHotspots(hotspots, clusters);
 	}
 
-    /** should remove a presentable from the hotspots vector when part of cluster
-     *  ### implement it the other way around
-     */
-    private void removeClusteredHotspots(Vector hotspots, Vector clusters) {
-        for (int i = 0; i &lt; hotspots.size(); i++) {
-            Vector topics = (Vector) hotspots.get(i);
-            Vector doubled = new Vector();
-            for (int j = 1; j &lt; topics.size(); j++) {
-                PresentableTopic topic = (PresentableTopic) topics.get(j);
-                if (isPartOfCluster(clusters, topic.getID())) {
-                    // topic is visible in cluster
-                    doubled.add(topic);
-                }
-            }
-            topics.removeAll(doubled);
-        }
-    }
+	/** should remove a presentable from the hotspots vector when part of cluster
+	 *  ### implement it the other way around
+	 */
+	private void removeClusteredHotspots(Vector hotspots, Vector clusters) {
+		for (int i = 0; i &lt; hotspots.size(); i++) {
+			Vector topics = (Vector) hotspots.get(i);
+			Vector doubled = new Vector();
+			for (int j = 1; j &lt; topics.size(); j++) {
+				PresentableTopic topic = (PresentableTopic) topics.get(j);
+				if (isPartOfCluster(clusters, topic.getID())) {
+					// topic is visible in cluster
+					doubled.add(topic);
+				}
+			}
+			topics.removeAll(doubled);
+		}
+	}
 
-    private boolean isPartOfCluster(Vector clusters, String topicId) {
-        for (int i = 0; i &lt; clusters.size(); i++) {
-            Cluster object = (Cluster) clusters.get(i);
-            Vector topics = object.getPresentables();
-            for (int j = 0; j &lt; topics.size(); j++) {
-                PresentableTopic topic = (PresentableTopic) topics.get(j);
-                if (topic.getID().equals(topicId)) {
-                    return true;
-                }
-            }
-        }
-        return false;
-    }
+	private boolean isPartOfCluster(Vector clusters, String topicId) {
+		for (int i = 0; i &lt; clusters.size(); i++) {
+			Cluster object = (Cluster) clusters.get(i);
+			Vector topics = object.getPresentables();
+			for (int j = 0; j &lt; topics.size(); j++) {
+				PresentableTopic topic = (PresentableTopic) topics.get(j);
+				if (topic.getID().equals(topicId)) {
+					return true;
+				}
+			}
+		}
+		return false;
+	}
 
 	private Cluster findAndCheckClusters(PresentableTopic currentPT, Vector clusters){
 			for (int c=0; c &lt; clusters.size(); c++) {
@@ -820,39 +821,37 @@
 		return getCurrentCriteria(session).selectedCategoryIDs;
 	}
 
-  private void initSelectedCatAttribute(Session session) {
-      session.setAttribute(&quot;selectedCatId&quot;, null); // necessary for the new cityMap
-  }
+	private void initSelectedCatAttribute(Session session) {
+		session.setAttribute(&quot;selectedCatId&quot;, null); // necessary for the new cityMap
+	}
 
-  // ---
+	// ---
 
-  private Hashtable parseRequestedPath(String[] elements) {
-    Hashtable result = new Hashtable();
-    for (int i = 0; i &lt; elements.length; i++) {
-      String key = elements[i];
-      try { // ### if one nomen has no attributes, the whole request fails
-        if (key.equals(&quot;layer&quot;)) {
-          result.put(&quot;layer&quot;, elements[i+1]);
-        } else if (key.equals(&quot;p&quot;)) {
-          result.put(&quot;geo&quot;, elements[i+1]);
-        } else if (key.equals(&quot;linkTo&quot;)) {
-          result.put(&quot;linkTo&quot;, elements[i+1]);
-        } else if (key.equals(&quot;categories&quot;)) {
-          result.put(&quot;categories&quot;, elements[i+1]);
-        } else if (key.equals(&quot;criteria&quot;)) {
-          result.put(&quot;criteria&quot;, Integer.parseInt(elements[i+1])-1);
-        } else if (key.equals(&quot;search&quot;)) {
-          result.put(&quot;search&quot;, elements[i+1]);
-        } else {
-          // skip this..
-        }
-      } catch (ArrayIndexOutOfBoundsException ex) {
-        return null;
-      }
-    }
-    // System.out.println(&quot;DEBUG: pathInfo.layer: \&quot;&quot; + result.get(&quot;layer&quot;) + &quot;\&quot; geoObject: \&quot;&quot; + result.get(&quot;geo&quot;) +&quot;\&quot; category: \&quot;&quot; +
-       //  result.get(&quot;category&quot;) + &quot;\&quot; criteria: \&quot;&quot; + result.get(&quot;criteria&quot;) + &quot;\&quot; search: \&quot;&quot; + result.get(&quot;search&quot;) + &quot;\&quot;&quot;);
-    return result;
-  }
-  
+	private Hashtable parseRequestedPath(String[] elements) {
+		Hashtable result = new Hashtable();
+		for (int i = 0; i &lt; elements.length; i++) {
+			String key = elements[i];
+			try { // ### if one nomen has no attributes, the whole request fails
+				if (key.equals(&quot;layer&quot;)) {
+					result.put(&quot;layer&quot;, elements[i+1]);
+				} else if (key.equals(&quot;p&quot;)) {
+				 	result.put(&quot;geo&quot;, elements[i+1]);
+				} else if (key.equals(&quot;linkTo&quot;)) {
+					result.put(&quot;linkTo&quot;, elements[i+1]);
+				} else if (key.equals(&quot;categories&quot;)) {
+					result.put(&quot;categories&quot;, elements[i+1]);
+				} else if (key.equals(&quot;criteria&quot;)) {
+					result.put(&quot;criteria&quot;, Integer.parseInt(elements[i+1])-1);
+				} else if (key.equals(&quot;search&quot;)) {
+					result.put(&quot;search&quot;, elements[i+1]);
+				} else {
+					// skip this..
+				}
+			} catch (ArrayIndexOutOfBoundsException ex) {
+				return null;
+			}
+		}
+		return result;
+	}
+
 }

Modified: trunk/src/de/kiezatlas/deepamehta/KiezAtlas.java
===================================================================
--- trunk/src/de/kiezatlas/deepamehta/KiezAtlas.java	2012-11-09 13:07:37 UTC (rev 108)
+++ trunk/src/de/kiezatlas/deepamehta/KiezAtlas.java	2012-11-09 13:43:16 UTC (rev 109)
@@ -49,7 +49,7 @@
 
 
 
-    static final String TOPICTYPE_CITY = &quot;tt-city&quot;;
+	static final String TOPICTYPE_CITY = &quot;tt-city&quot;;
 	static final String TOPICTYPE_CITYMAP = &quot;tt-ka-stadtplan&quot;;
 	static final String TOPICTYPE_KIEZ_GEO = &quot;tt-ka-geoobject&quot;;
 	static final String TOPICTYPE_KIEZ_GEO_SEARCH = &quot;tt-ka-geoobject-search&quot;;
@@ -132,37 +132,37 @@
 	static final String PROPERTY_AGENCY_KIND = &quot;Art&quot;;
 	static final String PROPERTY_YADE_X = &quot;YADE x&quot;;
 	static final String PROPERTY_YADE_Y = &quot;YADE y&quot;;
-    static final String PROPERTY_GPS_LONG = &quot;LONG&quot;;
-    static final String PROPERTY_GPS_LAT = &quot;LAT&quot;;
+	static final String PROPERTY_GPS_LONG = &quot;LONG&quot;;
+	static final String PROPERTY_GPS_LAT = &quot;LAT&quot;;
 	static final String PROPERTY_LAST_MODIFIED = &quot;Zuletzt ge&#228;ndert&quot;;
-    static final String PROPERTY_LAST_UPDATED = &quot;Zuletzt aktualisiert&quot;;
+	static final String PROPERTY_LAST_UPDATED = &quot;Zuletzt aktualisiert&quot;;
 	//
 	static final String PROPERTY_FORUM_ACTIVITION = &quot;Aktivierung&quot;;
 	static final String PROPERTY_COMMENT_AUTHOR = &quot;Autor&quot;;
 	static final String PROPERTY_COMMENT_DATE = &quot;Datum&quot;;
 	static final String PROPERTY_COMMENT_TIME = &quot;Uhrzeit&quot;;
-    //
-    static final String PROPERTY_TAGFIELD = &quot;Stichworte&quot;;
 	//
+	static final String PROPERTY_TAGFIELD = &quot;Stichworte&quot;;
+	//
 	static final String PROPERTY_TARGET_WEBALIAS = &quot;Target Web Alias&quot;;
 	//
 	static final String PROPERTY_CSS = &quot;CSS&quot;;
-    //
-    // TOPICTYPE_IMPORTER_SETTINGS Properties
-    static final String PROPERTY_ICONS_MAP = &quot;Icons / Kategorien&quot;;
-    static final String PROPERTY_ICON_CAT_DIVIDER = &quot;:&quot;;
-    static final String PROPERTY_IMPORT_CONTENT_REPORT = &quot;Content Report Mailbox&quot;;
-    static final String PROPERTY_IMPORT_SERVICE_REPORT = &quot;Service Report Mailbox&quot;;
-    // Event imported Properties
-    static final String PROPERTY_EVENT_DESCRIPTION = &quot;Beschreibung&quot;;
-    static final String PROPERTY_EVENT_TIME = &quot;Datum / Zeit&quot;;
-    // Event and Engagment imported Properties
-    static final String PROPERTY_PROJECT_ORIGIN_ID = &quot;OriginId&quot;;
-    static final String PROPERTY_PROJECT_LAST_MODIFIED = &quot;Timestamp&quot;;
-    static final String PROPERTY_PROJECT_ORGANISATION = &quot;Organisation&quot;;
-    static final String PROPERTY_WORKSPACE_ALIAS = &quot;Workspace Web Alias&quot;;
-    // KiezAtlas-App Property to publish citymaps in html5 mobile client
-    static final String PROPERTY_MOBILE_CITYMAP = &quot;Mobiler Stadtplan&quot;;
+	//
+	// TOPICTYPE_IMPORTER_SETTINGS Properties
+	static final String PROPERTY_ICONS_MAP = &quot;Icons / Kategorien&quot;;
+	static final String PROPERTY_ICON_CAT_DIVIDER = &quot;:&quot;;
+	static final String PROPERTY_IMPORT_CONTENT_REPORT = &quot;Content Report Mailbox&quot;;
+	static final String PROPERTY_IMPORT_SERVICE_REPORT = &quot;Service Report Mailbox&quot;;
+	// Event imported Properties
+	static final String PROPERTY_EVENT_DESCRIPTION = &quot;Beschreibung&quot;;
+	static final String PROPERTY_EVENT_TIME = &quot;Datum / Zeit&quot;;
+	// Event and Engagment imported Properties
+	static final String PROPERTY_PROJECT_ORIGIN_ID = &quot;OriginId&quot;;
+	static final String PROPERTY_PROJECT_LAST_MODIFIED = &quot;Timestamp&quot;;
+	static final String PROPERTY_PROJECT_ORGANISATION = &quot;Organisation&quot;;
+	static final String PROPERTY_WORKSPACE_ALIAS = &quot;Workspace Web Alias&quot;;
+	// KiezAtlas-App Property to publish citymaps in html5 mobile client
+	static final String PROPERTY_MOBILE_CITYMAP = &quot;Mobiler Stadtplan&quot;;
 
 	// -----------------------
 	// --- Property Values ---
@@ -180,24 +180,24 @@
 	// ----------------
 
 
-    static final String ITEM_LOAD_COORDINATES = &quot;Load All GPS Coordinates&quot;;
-    static final String  CMD_START_GEOCODING = &quot;loadGeoCodes&quot;;
+	static final String ITEM_LOAD_COORDINATES = &quot;Load All GPS Coordinates&quot;;
+	static final String  CMD_START_GEOCODING = &quot;loadGeoCodes&quot;;
 
-    static final String ITEM_LOAD_EMPTY_COORDINATES = &quot;Load Empty GPS Coordinates&quot;;
-    static final String  CMD_START_EMPTY_GEOCODING = &quot;loadEmptyGeoCodes&quot;;
+	static final String ITEM_LOAD_EMPTY_COORDINATES = &quot;Load Empty GPS Coordinates&quot;;
+	static final String  CMD_START_EMPTY_GEOCODING = &quot;loadEmptyGeoCodes&quot;;
 
-    static final String ITEM_LOCK_GEOMETRY = &quot;Lock&quot;;
-    static final String  CMD_LOCK_GEOMETRY = &quot;lockGeometry&quot;;
-        //
-    static final String ITEM_UNLOCK_GEOMETRY = &quot;Unlock&quot;;
-    static final String  CMD_UNLOCK_GEOMETRY = &quot;unlockGeometry&quot;;
-        //
-    static final String ITEM_REPOSITION_ALL = &quot;Reposition all&quot;;
-    static final String  CMD_REPOSITION_ALL = &quot;repositionAll&quot;;
-    static final String ICON_REPOSITION_ALL = &quot;location.png&quot;;
-        //
-    static final String ITEM_MAKE_SHAPE = &quot;Make Shape&quot;;
-    static final String  CMD_MAKE_SHAPE = &quot;makeShape&quot;;
+	static final String ITEM_LOCK_GEOMETRY = &quot;Lock&quot;;
+	static final String  CMD_LOCK_GEOMETRY = &quot;lockGeometry&quot;;
+	//
+	static final String ITEM_UNLOCK_GEOMETRY = &quot;Unlock&quot;;
+	static final String  CMD_UNLOCK_GEOMETRY = &quot;unlockGeometry&quot;;
+	//
+	static final String ITEM_REPOSITION_ALL = &quot;Reposition all&quot;;
+	static final String  CMD_REPOSITION_ALL = &quot;repositionAll&quot;;
+	static final String ICON_REPOSITION_ALL = &quot;location.png&quot;;
+	//
+	static final String ITEM_MAKE_SHAPE = &quot;Make Shape&quot;;
+	static final String  CMD_MAKE_SHAPE = &quot;makeShape&quot;;
 
 
 
@@ -220,7 +220,7 @@
 	public static final int SERVLET_IMPORT = 5;
 	public static final int SERVLET_MAPS = 6;
 	public static final int SERVLET_ATLAS = 7;
-    public static final int SERVLET_WORKSPACE = 8;
+	public static final int SERVLET_WORKSPACE = 8;
 
 
 
@@ -262,8 +262,8 @@
 	public static final String ACTION_ACTIVATE_FORUM = &quot;activateForum&quot;;
 	public static final String ACTION_DEACTIVATE_FORUM = &quot;deactivateForum&quot;;
 	public static final String ACTION_DELETE_COMMENT = &quot;deleteComment&quot;;
-    // workspace
-    public static final String ACTION_SHOW_WORKSPACE_FORM = &quot;showWorkspaceForm&quot;;
+	// workspace
+	public static final String ACTION_SHOW_WORKSPACE_FORM = &quot;showWorkspaceForm&quot;;
 	// list servlet
 	public static final String ACTION_SHOW_INSTITUTIONS = &quot;showInstitutions&quot;;
 	public static final String ACTION_SHOW_INSTITUTIONS_SLIM = &quot;showSlimInstitution&quot;;
@@ -281,13 +281,12 @@
 	public static final String ACTION_DOWNLOAD_CITYMAP =&quot;downloadCityMap&quot;;
 	public static final String ACTION_SHOW_LIST_LEGEND =&quot;showListLegend&quot;;
 	// import servlet
-    public static final String ACTION_SHOW_IMPORTS = &quot;showImports&quot;;
-    public static final String ACTION_SHOW_REPORT = &quot;showImportReport&quot;;
-    public static final String ACTION_DO_IMPORT = &quot;doImport&quot;;
-    public static final String ACTION_RESET_CRITERIAS = &quot;resetCritCats&quot;;
-    // Maps Servlets
-    public static final String ACTION_GEO_CODE = &quot;geoCode&quot;;
-  
+	public static final String ACTION_SHOW_IMPORTS = &quot;showImports&quot;;
+	public static final String ACTION_SHOW_REPORT = &quot;showImportReport&quot;;
+	public static final String ACTION_DO_IMPORT = &quot;doImport&quot;;
+	public static final String ACTION_RESET_CRITERIAS = &quot;resetCritCats&quot;;
+	// Maps Servlets
+	public static final String ACTION_GEO_CODE = &quot;geoCode&quot;;
 
 
 
@@ -297,8 +296,8 @@
 
 
 
-    static final String SEARCHMODE_BY_NAME = &quot;byName&quot;;
-    // Note: other search modes are generated dynamically: &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, ....
+	static final String SEARCHMODE_BY_NAME = &quot;byName&quot;;
+	// Note: other search modes are generated dynamically: &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, ....
 
 
 
@@ -308,8 +307,8 @@
 
 
 
-    static final String FRAME_LEFT = &quot;left&quot;;
-    static final String FRAME_RIGHT = &quot;right&quot;;
+	static final String FRAME_LEFT = &quot;left&quot;;
+	static final String FRAME_RIGHT = &quot;right&quot;;
 
 
 
@@ -320,44 +319,44 @@
 
 
 	// atlas
-    static final String PAGE_BERLIN_ATLAS = &quot;be.de/BerlinAtlas&quot;;
-    static final String PAGE_MAP_ATLAS = &quot;be.de/AlternativeAtlas&quot;;
-        // browse
-    static final String PAGE_FRAMESET = &quot;frameset&quot;;
-    static final String PAGE_CITY_MAP = &quot;CityMap&quot;;
-    static final String PAGE_CATEGORY_LIST = &quot;CategoryList&quot;;
-    static final String PAGE_GEO_LIST = &quot;GeoObjectList&quot;;
-    static final String PAGE_GEO_INFO = &quot;GeoObjectInfo&quot;;
-    static final String PAGE_GEO_FORUM = &quot;GeoObjectForum&quot;;
-    static final String PAGE_COMMENT_FORM = &quot;CommentForm&quot;;
-    static final String PAGE_MAP_LOGIN = &quot;MapLogin&quot;;
-    // workspace
-    static final String PAGE_WORKSPACE_LOGIN = &quot;WorkspaceObjectLogin&quot;;
-    static final String PAGE_WORKSPACE_FORM = &quot;WorkspaceObjectForm&quot;;
-    static final String PAGE_WORKSPACE_OBJECT_ADDED = &quot;WorkspaceObjectAdded&quot;;
-    static final String PAGE_WORKSPACE_ERROR = &quot;error&quot;;
-    // edit
-    static final String PAGE_GEO_LOGIN = &quot;GeoObjectLogin&quot;;
-    static final String PAGE_GEO_HOME = &quot;GeoObjectHome&quot;;
-    static final String PAGE_GEO_FORM = &quot;GeoObjectForm&quot;;
-    static final String PAGE_FORUM_ADMINISTRATION = &quot;ForumAdministration&quot;;
-    // list
-    static final String PAGE_LIST_LOGIN = &quot;ListLogin&quot;;
-    static final String PAGE_LIST_HOME = &quot;ListHome&quot;;
-    static final String PAGE_LIST = &quot;List&quot;;
-    static final String PAGE_SLIM_LIST = &quot;SlimList&quot;;
-    static final String PAGE_GEO_ADMIN_FORM = &quot;GeoObjectAdminForm&quot;;
-    static final String PAGE_GEO_EMPTY_FORM = &quot;GeoObjectEmptyForm&quot;;
+	static final String PAGE_BERLIN_ATLAS = &quot;be.de/BerlinAtlas&quot;;
+	static final String PAGE_MAP_ATLAS = &quot;be.de/AlternativeAtlas&quot;;
+		// browse
+	static final String PAGE_FRAMESET = &quot;frameset&quot;;
+	static final String PAGE_CITY_MAP = &quot;CityMap&quot;;
+	static final String PAGE_CATEGORY_LIST = &quot;CategoryList&quot;;
+	static final String PAGE_GEO_LIST = &quot;GeoObjectList&quot;;
+	static final String PAGE_GEO_INFO = &quot;GeoObjectInfo&quot;;
+	static final String PAGE_GEO_FORUM = &quot;GeoObjectForum&quot;;
+	static final String PAGE_COMMENT_FORM = &quot;CommentForm&quot;;
+	static final String PAGE_MAP_LOGIN = &quot;MapLogin&quot;;
+	// workspace
+	static final String PAGE_WORKSPACE_LOGIN = &quot;WorkspaceObjectLogin&quot;;
+	static final String PAGE_WORKSPACE_FORM = &quot;WorkspaceObjectForm&quot;;
+	static final String PAGE_WORKSPACE_OBJECT_ADDED = &quot;WorkspaceObjectAdded&quot;;
+	static final String PAGE_WORKSPACE_ERROR = &quot;error&quot;;
+	// edit
+	static final String PAGE_GEO_LOGIN = &quot;GeoObjectLogin&quot;;
+	static final String PAGE_GEO_HOME = &quot;GeoObjectHome&quot;;
+	static final String PAGE_GEO_FORM = &quot;GeoObjectForm&quot;;
+	static final String PAGE_FORUM_ADMINISTRATION = &quot;ForumAdministration&quot;;
+	// list
+	static final String PAGE_LIST_LOGIN = &quot;ListLogin&quot;;
+	static final String PAGE_LIST_HOME = &quot;ListHome&quot;;
+	static final String PAGE_LIST = &quot;List&quot;;
+	static final String PAGE_SLIM_LIST = &quot;SlimList&quot;;
+	static final String PAGE_GEO_ADMIN_FORM = &quot;GeoObjectAdminForm&quot;;
+	static final String PAGE_GEO_EMPTY_FORM = &quot;GeoObjectEmptyForm&quot;;
 	static final String PAGE_LINK_PAGE = &quot;Print&quot;; // Link Page
 	static final String PAGE_DOWNLOAD_PAGE = &quot;Download&quot;; // Link Page
 	static final String PAGE_LIST_INFO = &quot;ListHelp&quot;;
 	static final String PAGE_LIST_MAILING = &quot;ListMailing&quot;;
 	// import
-    static final String PAGE_IMPORTS_LOGIN = &quot;ImportsLogin&quot;;
-    static final String PAGE_IMPORTS_HOME = &quot;ImportsHome&quot;;
-    static final String PAGE_REPORT_HOME = &quot;ReportInfo&quot;;
-    // error
-    static final String PAGE_ERROR = &quot;error&quot;;
-    // service
-    static final String PAGE_SERVE = &quot;Serve&quot;;
+	static final String PAGE_IMPORTS_LOGIN = &quot;ImportsLogin&quot;;
+	static final String PAGE_IMPORTS_HOME = &quot;ImportsHome&quot;;
+	static final String PAGE_REPORT_HOME = &quot;ReportInfo&quot;;
+	// error
+	static final String PAGE_ERROR = &quot;error&quot;;
+	// service
+	static final String PAGE_SERVE = &quot;Serve&quot;;
 }

Modified: trunk/src/de/kiezatlas/deepamehta/KiezServlet.java
===================================================================
--- trunk/src/de/kiezatlas/deepamehta/KiezServlet.java	2012-11-09 13:07:37 UTC (rev 108)
+++ trunk/src/de/kiezatlas/deepamehta/KiezServlet.java	2012-11-09 13:43:16 UTC (rev 109)
@@ -23,743 +23,720 @@
 
 public class KiezServlet extends JSONRPCServlet implements KiezAtlas {
 
-    // --- 3 Hooks overriden
+	// --- 3 Hooks overriden
 
-    protected String performPostRequest(String remoteMethod, String params, 
-                                        Session session, CorporateDirectives directives)
-    {
-        // System.out.println(&quot;POST Request received... &quot; + remoteMethod + &quot;:&quot; + params);
-        String result = &quot;&quot;;
-        if ( remoteMethod.equals(&quot;getMapTopics&quot;) ) {
-            result = getGeoMapTopics(params, session, directives);
-        } else if ( remoteMethod.equals(&quot;getGeoObjectInfo&quot;) ) {
-            result = getGeoObjectInfo(params);
-        } else if ( remoteMethod.equals(&quot;getWorkspaceCriterias&quot;) ) {
-            result = getWorkspaceCriterias(params);
-        } else if ( remoteMethod.equals(&quot;getWorkspaceInfos&quot;) ) {
-            result = getWorkspaceInfos(params);
-        } else if ( remoteMethod.equals(&quot;getCityMaps&quot;) ) {
-            result = getCityMaps(params);
-        } else if ( remoteMethod.equals(&quot;getMobileCityMaps&quot;) ) {
-            result = getMobileCityMaps(params);
-        } else if ( remoteMethod.equals(&quot;searchGeoObjects&quot;) ) {
-            result = searchTopics(params, directives);
-        } else if ( remoteMethod.equals(&quot;geoCode&quot;) ) {
-            result = getGeoCode(params);
-        } else if ( remoteMethod.equals(&quot;oldGeoCode&quot;) ) {
-            result = getOldGeoCode(params);
-        }
-        return result;
-    }
+	protected String performPostRequest(String remoteMethod, String params, 
+									Session session, CorporateDirectives directives) {
+		String result = &quot;&quot;;
+		if ( remoteMethod.equals(&quot;getMapTopics&quot;) ) {
+			result = getGeoMapTopics(params, session, directives);
+		} else if ( remoteMethod.equals(&quot;getGeoObjectInfo&quot;) ) {
+			result = getGeoObjectInfo(params);
+		} else if ( remoteMethod.equals(&quot;getWorkspaceCriterias&quot;) ) {
+			result = getWorkspaceCriterias(params);
+		} else if ( remoteMethod.equals(&quot;getWorkspaceInfos&quot;) ) {
+			result = getWorkspaceInfos(params);
+		} else if ( remoteMethod.equals(&quot;getCityMaps&quot;) ) {
+			result = getCityMaps(params);
+		} else if ( remoteMethod.equals(&quot;getMobileCityMaps&quot;) ) {
+			result = getMobileCityMaps(params);
+		} else if ( remoteMethod.equals(&quot;searchGeoObjects&quot;) ) {
+			result = searchTopics(params, directives);
+		} else if ( remoteMethod.equals(&quot;geoCode&quot;) ) {
+			result = getGeoCode(params);
+		} else if ( remoteMethod.equals(&quot;oldGeoCode&quot;) ) {
+			result = getOldGeoCode(params);
+		}
+		return result;
+	}
 
-    protected String performAction(String topicId, String params, Session session, CorporateDirectives directives)
-    {
-        session.setAttribute(&quot;info&quot;, &quot;&lt;h3&gt;Willkommen zu dem Kiezatlas Dienst unter &quot; 
-            + as.getCorporateWebBaseURL() + &quot;&lt;/h3&gt;&lt;br&gt;F&uuml;r die Nutzung des Dienstes steht Entwicklern &quot;
-            + &quot;&lt;a href=\&quot;<A HREF="http://www.deepamehta.de/wiki/en/Application:_Web_Service\">http://www.deepamehta.de/wiki/en/Application:_Web_Service\</A>&quot;&gt;hier&lt;/a&gt; die Software &quot;
-            + &quot; Dokumentation zur Verf&#252;gung. Ein Beispiel zur Nutzung eines Kiezatlas Dienstes ist &quot;
-            + &quot;&lt;a href=\&quot;<A HREF="http://www.kiezatlas.de/maps/map.php?topicId=t-ka-schoeneberg&amp;workspaceId=t-ka-workspace\">http://www.kiezatlas.de/maps/map.php?topicId=t-ka-schoeneberg&amp;workspaceId=t-ka-workspace\</A>&quot;&gt;&quot;
-            + &quot;hier&lt;/a&gt; abrufbar.&quot;);
-        return PAGE_SERVE;
-    }
+	protected String performAction(String topicId, String params, Session session, CorporateDirectives directives) {
+		session.setAttribute(&quot;info&quot;, &quot;&lt;h3&gt;Willkommen zu dem Kiezatlas Dienst unter &quot; 
+			+ as.getCorporateWebBaseURL() + &quot;&lt;/h3&gt;&lt;br&gt;F&uuml;r die Nutzung des Dienstes steht Entwicklern &quot;
+			+ &quot;&lt;a href=\&quot;<A HREF="http://www.deepamehta.de/wiki/en/Application:_Web_Service\">http://www.deepamehta.de/wiki/en/Application:_Web_Service\</A>&quot;&gt;hier&lt;/a&gt; die Software &quot;
+			+ &quot; Dokumentation zur Verf&#252;gung. Ein Beispiel zur Nutzung eines Kiezatlas Dienstes ist &quot;
+			+ &quot;&lt;a href=\&quot;<A HREF="http://www.kiezatlas.de/maps/map.php?topicId=t-ka-schoeneberg&amp;workspaceId=t-ka-workspace\">http://www.kiezatlas.de/maps/map.php?topicId=t-ka-schoeneberg&amp;workspaceId=t-ka-workspace\</A>&quot;&gt;&quot;
+			+ &quot;hier&lt;/a&gt; abrufbar.&quot;);
+		return PAGE_SERVE;
+	}
 
-    protected void preparePage(String page, String params, Session session, CorporateDirectives directives)
-    {
-        session.setAttribute(&quot;forumActivition&quot;, &quot;off&quot;);
-    }
+	protected void preparePage(String page, String params, Session session, CorporateDirectives directives) {
+		session.setAttribute(&quot;forumActivition&quot;, &quot;off&quot;);
+	}
 
-    // --- Remote Methods
+	// --- Remote Methods
 
-    private String getGeoObjectInfo(String params)
-    {
-        String topicId = params.substring(2,params.length()-2);
-        System.out.println(&quot;&gt;&gt;&gt;&gt; getGeoObjectInfo(&quot; + topicId + &quot;)&quot;);
-        // String parameters[] = params.split(&quot;,&quot;);
-        StringBuffer messages = new StringBuffer(&quot;\&quot;&quot;);
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        String geoObjectString;
-        try {
-            BaseTopic t = cm.getTopic(topicId, 1);
-            if (t != null &amp;&amp; t.getType().equals(&quot;tt-user&quot;)) {
-                System.out.println(&quot;*** KiezServlet.SecurityAccessDenied: not allowed to access user information&quot;);
-                messages = new StringBuffer(&quot;Access Denied&quot;);
-                geoObjectString= &quot;\&quot;\&quot;&quot;;
-            } else if (t != null) {
-                geoObjectString = createGeoObjectBean(t, messages);
-            } else {
-                geoObjectString = &quot;{}&quot;;
-                messages.append(&quot;404 - Topic not found&quot;);
-            }
-        } catch (Exception tex) {
-            geoObjectString = &quot;{}&quot;;
-            messages.append(&quot;&quot;+toJSON(tex.toString())+&quot; - 404 - Topic not found&quot;);
-        }
-        result.append(geoObjectString);
-        messages.append(&quot;\&quot;&quot;);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        // System.out.println(&quot;result: &quot;+ result.toString());
-        return result.toString();
-    }
+	private String getGeoObjectInfo(String params) {
+		String topicId = params.substring(2,params.length()-2);
+		System.out.println(&quot;&gt;&gt;&gt;&gt; getGeoObjectInfo(&quot; + topicId + &quot;)&quot;);
+		// String parameters[] = params.split(&quot;,&quot;);
+		StringBuffer messages = new StringBuffer(&quot;\&quot;&quot;);
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		String geoObjectString;
+		try {
+			BaseTopic t = cm.getTopic(topicId, 1);
+			if (t != null &amp;&amp; t.getType().equals(&quot;tt-user&quot;)) {
+				System.out.println(&quot;*** KiezServlet.SecurityAccessDenied: not allowed to access user information&quot;);
+				messages = new StringBuffer(&quot;Access Denied&quot;);
+				geoObjectString= &quot;\&quot;\&quot;&quot;;
+			} else if (t != null) {
+				geoObjectString = createGeoObjectBean(t, messages);
+			} else {
+				geoObjectString = &quot;{}&quot;;
+				messages.append(&quot;404 - Topic not found&quot;);
+			}
+		} catch (Exception tex) {
+			geoObjectString = &quot;{}&quot;;
+			messages.append(&quot;&quot;+toJSON(tex.toString())+&quot; - 404 - Topic not found&quot;);
+		}
+		result.append(geoObjectString);
+		messages.append(&quot;\&quot;&quot;);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		// System.out.println(&quot;result: &quot;+ result.toString());
+		return result.toString();
+	}
 
 
-    /**
-     * Serializes Criterias and their Categories for a worksapce into JSON
-     *
-     * @param params
-     * @return
-     */
-    private String getWorkspaceCriterias(String params)
-    {
-        String mapId = params.substring(2, params.length()-2);
-        StringBuffer messages = null;
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        String criteriaList = createCritCatSystemList(mapId);
-        result.append(criteriaList);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        // System.out.println(&quot;[DEBUG] .. &quot; + result.toString() + &quot; \n &quot;);
-        return result.toString();
-    }
+	/**
+	 * Serializes Criterias and their Categories for a worksapce into JSON
+	 *
+	 * @param params
+	 * @return
+	 */
+	private String getWorkspaceCriterias(String params) {
+		String mapId = params.substring(2, params.length()-2);
+		StringBuffer messages = null;
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		String criteriaList = createCritCatSystemList(mapId);
+		result.append(criteriaList);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		// System.out.println(&quot;[DEBUG] .. &quot; + result.toString() + &quot; \n &quot;);
+		return result.toString();
+	}
 
-    /**
-     * Serializes Workspace Infos into JSON
-     *
-     * @param params
-     * @return
-     */
-    private String getWorkspaceInfos(String params)
-    {
-        System.out.println(&quot;&gt;&gt;&gt;&gt; getWorkspaceInfos(&quot; + params + &quot;)&quot;);
-        String parameters[] = params.split(&quot;:&quot;);
-        String workspaceId = parameters[0];
-        StringBuffer messages = null;
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        String infos = createWorkspaceInfos(workspaceId.substring(2, workspaceId.length()-2));
-        result.append(infos);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        return result.toString();
-    }
+	/**
+	 * Serializes Workspace Infos into JSON
+	 *
+	 * @param params
+	 * @return
+	 */
+	private String getWorkspaceInfos(String params) {
+		System.out.println(&quot;&gt;&gt;&gt;&gt; getWorkspaceInfos(&quot; + params + &quot;)&quot;);
+		String parameters[] = params.split(&quot;:&quot;);
+		String workspaceId = parameters[0];
+		StringBuffer messages = null;
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		String infos = createWorkspaceInfos(workspaceId.substring(2, workspaceId.length()-2));
+		result.append(infos);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		return result.toString();
+	}
 
-    /**
-     * Serializes Workspace Infos into JSON
-     *
-     * @param params
-     * @return
-     */
-    private String getCityMaps(String params)
-    {
-        System.out.println(&quot;&gt;&gt;&gt;&gt; getCityMaps(&quot; + params + &quot;)&quot;);
-        String parameters[] = params.split(&quot;:&quot;);
-        String workspaceId = parameters[0];
-        StringBuffer messages = null;
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        String infos = createCityMaps(workspaceId.substring(2, workspaceId.length()-2));
-        result.append(infos);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        return result.toString();
-    }
+	/**
+	 * Serializes Workspace Infos into JSON
+	 *
+	 * @param params
+	 * @return
+	 */
+	private String getCityMaps(String params) {
+		System.out.println(&quot;&gt;&gt;&gt;&gt; getCityMaps(&quot; + params + &quot;)&quot;);
+		String parameters[] = params.split(&quot;:&quot;);
+		String workspaceId = parameters[0];
+		StringBuffer messages = null;
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		String infos = createCityMaps(workspaceId.substring(2, workspaceId.length()-2));
+		result.append(infos);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		return result.toString();
+	}
 
-    /**
-     * Serializes Infos on mobile CityMaps into JSON
-     *
-     * @param params
-     * @return
-     */
-    private String getMobileCityMaps(String params)
-    {
-        System.out.println(&quot;&gt;&gt;&gt;&gt; getMobileCityMaps()&quot;);
-        StringBuffer messages = null;
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        String infos = createMobileCityMaps();
-        result.append(infos);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        return result.toString();
-    }
+	/**
+	 * Serializes Infos on mobile CityMaps into JSON
+	 *
+	 * @param params
+	 * @return
+	 */
+	private String getMobileCityMaps(String params) {
+		System.out.println(&quot;&gt;&gt;&gt;&gt; getMobileCityMaps()&quot;);
+		StringBuffer messages = null;
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		String infos = createMobileCityMaps();
+		result.append(infos);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		return result.toString();
+	}
 
-    /**
-     * search for topic property name and returns a list of slim geo objects as
-     * results
-     *
-     * @param params
-     * @param directives
-     * @return
-     */
-    private String searchTopics(String params, CorporateDirectives directives) {
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        StringBuffer messages = null;
-        String parameters[] = params.split(&quot;,&quot;);
-        String query = parameters[0];
-        String topicmapId = parameters[1];
-        String workspaceId = parameters[2];
-        query = query.substring(2, query.length()-1);
-        topicmapId = topicmapId.substring(2, topicmapId.length()-1);
-        workspaceId = workspaceId.substring(2, workspaceId.length()-2);
-        Vector criterias = getKiezCriteriaTypes(workspaceId);
-        BaseTopic geoType = getWorkspaceGeoType(workspaceId);
-        // perform search
-        Vector results = cm.getViewTopics(topicmapId, 1, geoType.getID(), query);
-        if (!query.equals(&quot;&quot;)) {
-          Hashtable propertyFilter = new Hashtable();
-          propertyFilter.put(PROPERTY_TAGFIELD, query);
-          Vector taggedInsts = cm.getTopics(geoType.getID(), propertyFilter, topicmapId);
-          for (int k = 0; k &lt; taggedInsts.size(); k++) {
-            BaseTopic taggedTopic = (BaseTopic) taggedInsts.get(k);
-            Vector pts = cm.getViewTopics(topicmapId, 1, geoType.getID(), taggedTopic.getName());
-            if (pts.size() &gt;= 1) {
-              if (!results.contains(pts.get(0))) { // prevent doublings..
-                results.add(pts.get(0));
-              } else {
-              }
-            } // insts.add(new PresentableTopic(topic, new Point()));
-          }
-        }
-        // +&quot; named and &quot;+streetResults.size()+ &quot; streetnames like &quot; + query);
-        System.out.println(&quot;   &gt; found &quot; + results.size() + &quot; by name and tag&quot;);
-        //
-        result.append(&quot;[&quot;);
-        for (int i=0; i &lt; results.size(); i++) {
-            BaseTopic topic = (BaseTopic) results.get(i);
-            result.append(createSlimGeoObject(topic, criterias, new StringBuffer()));
-            if (results.indexOf(topic) == results.size()-1) { // does not allow doublings
-                result.append(&quot;]&quot;);
-            } else {
-                result.append(&quot;, &quot;);
-            }
-        }
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        return result.toString();
-    }
+	/**
+	 * search for topic property name and returns a list of slim geo objects as
+	 * results
+	 *
+	 * @param params
+	 * @param directives
+	 * @return
+	 */
+	private String searchTopics(String params, CorporateDirectives directives) {
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		StringBuffer messages = null;
+		String parameters[] = params.split(&quot;,&quot;);
+		String query = parameters[0];
+		String topicmapId = parameters[1];
+		String workspaceId = parameters[2];
+		query = query.substring(2, query.length()-1);
+		topicmapId = topicmapId.substring(2, topicmapId.length()-1);
+		workspaceId = workspaceId.substring(2, workspaceId.length()-2);
+		Vector criterias = getKiezCriteriaTypes(workspaceId);
+		BaseTopic geoType = getWorkspaceGeoType(workspaceId);
+		// perform search
+		Vector results = cm.getViewTopics(topicmapId, 1, geoType.getID(), query);
+		if (!query.equals(&quot;&quot;)) {
+			Hashtable propertyFilter = new Hashtable();
+			propertyFilter.put(PROPERTY_TAGFIELD, query);
+			Vector taggedInsts = cm.getTopics(geoType.getID(), propertyFilter, topicmapId);
+			for (int k = 0; k &lt; taggedInsts.size(); k++) {
+				BaseTopic taggedTopic = (BaseTopic) taggedInsts.get(k);
+				Vector pts = cm.getViewTopics(topicmapId, 1, geoType.getID(), taggedTopic.getName());
+				if (pts.size() &gt;= 1) {
+					if (!results.contains(pts.get(0))) { // prevent doublings..
+						results.add(pts.get(0));
+					}
+				} // insts.add(new PresentableTopic(topic, new Point()));
+			}
+		}
+		// +&quot; named and &quot;+streetResults.size()+ &quot; streetnames like &quot; + query);
+		System.out.println(&quot;   &gt; found &quot; + results.size() + &quot; by name and tag&quot;);
+		//
+		result.append(&quot;[&quot;);
+		for (int i=0; i &lt; results.size(); i++) {
+			BaseTopic topic = (BaseTopic) results.get(i);
+			result.append(createSlimGeoObject(topic, criterias, new StringBuffer()));
+			if (results.indexOf(topic) == results.size()-1) { // does not allow doublings
+				result.append(&quot;]&quot;);
+			} else {
+				result.append(&quot;, &quot;);
+			}
+		}
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		return result.toString();
+	}
 
-    /**
-     * delivers all topics in a citymap as &quot;slim&quot; geoobjects
-     *
-     * @param params (mapId, workspaceId)
-     * @param session
-     * @param directives
-     * @return
-     */
-    private String getGeoMapTopics(String params, Session session, CorporateDirectives directives)
-    {
-        String parameters[] = params.split(&quot;,&quot;);
-        String mapId = parameters[0];
-        String workspaceId = parameters[1];
-        mapId = mapId.substring(2,mapId.length()-2);
-        workspaceId = workspaceId.substring(2, workspaceId.length()-2);
-        StringBuffer messages = null;
-        StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
-        StringBuffer mapTopics = new StringBuffer(&quot;{ \&quot;map\&quot;: \&quot;&quot; + mapId + &quot;\&quot;, \&quot;topics\&quot;: [&quot;);
-        //
-        BaseTopic geoType = (BaseTopic) getWorkspaceGeoType(workspaceId);
-        Vector criterias = getKiezCriteriaTypes(workspaceId);
-        Vector allTopics = cm.getTopics(geoType.getID(), new Hashtable(), mapId);
-        System.out.println(&quot;&gt;&gt;&gt; &quot; + allTopics.size() +&quot; within current map&quot;);
-        for(int i = 0; i&lt; allTopics.size(); i++) {
-            BaseTopic topic = (BaseTopic) allTopics.get(i);
-            String geo  = createSlimGeoObject(topic, criterias, messages);
-            mapTopics.append(geo);
-            if(allTopics.indexOf(topic) != allTopics.size() - 1) {
-                mapTopics.append(&quot;,&quot;);
-            }
-        }
-        mapTopics.append(&quot;]}&quot;);
-        result.append(mapTopics);
-        result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
-        return result.toString();
-    }
+	/**
+	 * delivers all topics in a citymap as &quot;slim&quot; geoobjects
+	 *
+	 * @param params (mapId, workspaceId)
+	 * @param session
+	 * @param directives
+	 * @return
+	 */
+	private String getGeoMapTopics(String params, Session session, CorporateDirectives directives) {
+		String parameters[] = params.split(&quot;,&quot;);
+		String mapId = parameters[0];
+		String workspaceId = parameters[1];
+		mapId = mapId.substring(2,mapId.length()-2);
+		workspaceId = workspaceId.substring(2, workspaceId.length()-2);
+		StringBuffer messages = null;
+		StringBuffer result = new StringBuffer(&quot;{\&quot;result\&quot;: &quot;);
+		StringBuffer mapTopics = new StringBuffer(&quot;{ \&quot;map\&quot;: \&quot;&quot; + mapId + &quot;\&quot;, \&quot;topics\&quot;: [&quot;);
+		//
+		BaseTopic geoType = (BaseTopic) getWorkspaceGeoType(workspaceId);
+		Vector criterias = getKiezCriteriaTypes(workspaceId);
+		Vector allTopics = cm.getTopics(geoType.getID(), new Hashtable(), mapId);
+		System.out.println(&quot;&gt;&gt;&gt; &quot; + allTopics.size() +&quot; within current map&quot;);
+		for(int i = 0; i&lt; allTopics.size(); i++) {
+			BaseTopic topic = (BaseTopic) allTopics.get(i);
+			String geo  = createSlimGeoObject(topic, criterias, messages);
+			mapTopics.append(geo);
+			if(allTopics.indexOf(topic) != allTopics.size() - 1) {
+				mapTopics.append(&quot;,&quot;);
+			}
+		}
+		mapTopics.append(&quot;]}&quot;);
+		result.append(mapTopics);
+		result.append(&quot;, \&quot;error\&quot;: &quot; + messages + &quot;}&quot;);
+		return result.toString();
+	}
 
-    private String getGeoCode(String params) {
-        // Set your return content type
-        // String q = params;// .getParameter(&quot;q&quot;);
-        String parameters[] = params.split(&quot;,&quot;);
-        String query = parameters[0];
-        String key = parameters[1];
-        String locale = parameters[2];
-        String result = &quot;&quot;;
-        // String topicmapId = parameters[2];
-        query = query.substring(2, query.length()-1);
-        key = key.substring(2, key.length()-1);
-        locale = locale.substring(2, locale.length()-2);
-        try {
-            query = URLEncoder.encode(query, &quot;UTF-8&quot;);
-            // Website url to open
-            String url = &quot;<A HREF="http://maps.googleapis.com/maps/api/geocode/json?address=">http://maps.googleapis.com/maps/api/geocode/json?address=</A>&quot; + query + &quot;&amp;sensor=false&quot;;
-            System.out.println(&quot;GeoCode =&gt;\&quot;&quot; + url + &quot;\&quot;&quot;);
-            // String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
-              // + query + &quot;&amp;output=json&amp;oe=utf8&amp;sensotr=false&amp;key=&quot;+key+locale;
-            URLConnection connection = new URL(url).openConnection();
-            connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json&quot;);
-            connection.setRequestProperty(&quot;Charset&quot;, &quot;ISO-8859-1&quot;);
-            // Get the response
-            BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), &quot;UTF-8&quot;));
-            StringBuilder sb = new StringBuilder();
-            String line;
-            while ((line = rd.readLine()) != null) {
-              sb.append(line);
-            }
-            rd.close();
-            result = sb.toString();
-        } catch (UnsupportedEncodingException ex) {
-            System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + ex.getMessage());
-        } catch (MalformedURLException mux) {
-            System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + mux.getMessage());
-        } catch (IOException ioex) {
-            System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + ioex.getMessage());
-        }
-        //
-        return result;
-    }
+	private String getGeoCode(String params) {
+		// Set your return content type
+		// String q = params;// .getParameter(&quot;q&quot;);
+		String parameters[] = params.split(&quot;,&quot;);
+		String query = parameters[0];
+		String key = parameters[1];
+		String locale = parameters[2];
+		String result = &quot;&quot;;
+		// String topicmapId = parameters[2];
+		query = query.substring(2, query.length()-1);
+		key = key.substring(2, key.length()-1);
+		locale = locale.substring(2, locale.length()-2);
+		try {
+			query = URLEncoder.encode(query, &quot;UTF-8&quot;);
+			// Website url to open
+			String url = &quot;<A HREF="http://maps.googleapis.com/maps/api/geocode/json?address=">http://maps.googleapis.com/maps/api/geocode/json?address=</A>&quot; + query + &quot;&amp;sensor=false&quot;;
+			System.out.println(&quot;GeoCode =&gt;\&quot;&quot; + url + &quot;\&quot;&quot;);
+			// String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
+					// + query + &quot;&amp;output=json&amp;oe=utf8&amp;sensotr=false&amp;key=&quot;+key+locale;
+			URLConnection connection = new URL(url).openConnection();
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json&quot;);
+			connection.setRequestProperty(&quot;Charset&quot;, &quot;ISO-8859-1&quot;);
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), &quot;UTF-8&quot;));
+			StringBuilder sb = new StringBuilder();
+			String line;
+			while ((line = rd.readLine()) != null) {
+				sb.append(line);
+			}
+			rd.close();
+			result = sb.toString();
+		} catch (UnsupportedEncodingException ex) {
+			System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + ex.getMessage());
+		} catch (MalformedURLException mux) {
+			System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + mux.getMessage());
+		} catch (IOException ioex) {
+			System.out.println(&quot;*** KiezServlet.getGeoCode ERROR: &quot; + ioex.getMessage());
+		}
+		//
+		return result;
+	}
 
-    private String getOldGeoCode(String params) {
-        // Set your return content type
-        // String q = params;// .getParameter(&quot;q&quot;);
-        String parameters[] = params.split(&quot;,&quot;);
-        String query = parameters[0];
-        String key = parameters[1];
-        String locale = parameters[2];
-        String result = &quot;&quot;;
-        // String topicmapId = parameters[2];
-        query = query.substring(2, query.length()-1);
-        key = key.substring(2, key.length()-1);
-        locale = locale.substring(2, locale.length()-2);
-        try {
-            // query = URLEncoder.encode(query, &quot;UTF-8&quot;);
-            query = query.replaceAll(&quot; &quot;, &quot;%20&quot;);
-            // Website url to open
-            // ### FIXME: &quot;gl=+locale&quot;
-            if (locale.equals(&quot;&quot;)) {
-              locale = &quot;de&quot;;
-            }
-            String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
-              + query + &quot;&amp;oe=utf8&amp;key=&quot;+key+&quot;&amp;output=json&amp;sensotr=false&amp;gl=&quot;+locale;
-            System.out.println(&quot;OldGeoCode =&gt;\&quot;&quot; + url + &quot;\&quot;&quot;);
-            // String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
-              // + query + &quot;&amp;output=json&amp;oe=utf8&amp;sensotr=false&amp;key=&quot;+key+locale;
-            URLConnection connection = new URL(url).openConnection();
-            connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json&quot;);
-            connection.setRequestProperty(&quot;Charset&quot;, &quot;ISO-8859-1&quot;);
-            // Get the response
-            BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), &quot;UTF-8&quot;));
-            StringBuilder sb = new StringBuilder();
-            String line;
-            while ((line = rd.readLine()) != null) {
-              sb.append(line);
-            }
-            rd.close();
-            result = sb.toString();
-        } catch (UnsupportedEncodingException ex) {
-            System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + ex.getMessage());
-        } catch (MalformedURLException mux) {
-            System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + mux.getMessage());
-        } catch (IOException ioex) {
-            System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + ioex.getMessage());
-        }
-        //
-        return result;
-    }
+	private String getOldGeoCode(String params) {
+		// Set your return content type
+		// String q = params;// .getParameter(&quot;q&quot;);
+		String parameters[] = params.split(&quot;,&quot;);
+		String query = parameters[0];
+		String key = parameters[1];
+		String locale = parameters[2];
+		String result = &quot;&quot;;
+		// String topicmapId = parameters[2];
+		query = query.substring(2, query.length()-1);
+		key = key.substring(2, key.length()-1);
+		locale = locale.substring(2, locale.length()-2);
+		try {
+			// query = URLEncoder.encode(query, &quot;UTF-8&quot;);
+			query = query.replaceAll(&quot; &quot;, &quot;%20&quot;);
+			// Website url to open
+			// ### FIXME: &quot;gl=+locale&quot;
+			if (locale.equals(&quot;&quot;)) locale = &quot;de&quot;;
+			String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
+					+ query + &quot;&amp;oe=utf8&amp;key=&quot;+key+&quot;&amp;output=json&amp;sensotr=false&amp;gl=&quot;+locale;
+			System.out.println(&quot;OldGeoCode =&gt;\&quot;&quot; + url + &quot;\&quot;&quot;);
+			// String url = &quot;<A HREF="http://maps.google.com/maps/geo?q=">http://maps.google.com/maps/geo?q=</A>&quot;
+					// + query + &quot;&amp;output=json&amp;oe=utf8&amp;sensotr=false&amp;key=&quot;+key+locale;
+			URLConnection connection = new URL(url).openConnection();
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json&quot;);
+			connection.setRequestProperty(&quot;Charset&quot;, &quot;ISO-8859-1&quot;);
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), &quot;UTF-8&quot;));
+			StringBuilder sb = new StringBuilder();
+			String line;
+			while ((line = rd.readLine()) != null) {
+				sb.append(line);
+			}
+			rd.close();
+			result = sb.toString();
+		} catch (UnsupportedEncodingException ex) {
+			System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + ex.getMessage());
+		} catch (MalformedURLException mux) {
+			System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + mux.getMessage());
+		} catch (IOException ioex) {
+			System.out.println(&quot;*** KiezServlet.getOldGeoCode ERROR: &quot; + ioex.getMessage());
+		}
+		//
+		return result;
+	}
 
-    // -------------------
-    // --- Utility Methods
-    // -------------------
+	// -------------------
+	// --- Utility Methods
+	// -------------------
 
-    private String createWorkspaceInfos(String workspaceId)
-    {
-        StringBuffer object = new StringBuffer();
-        String workspaceName = as.getTopicProperty(workspaceId, 1, PROPERTY_NAME);
-        String logoURL = &quot;&quot;;
-        String impressumURL = &quot;&quot;;
-        String homepageURL = &quot;&quot;;
-        //
-        BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
-        if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
-        BaseTopic homepage = as.getRelatedTopic(workspaceId, 
-          KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK, TOPICTYPE_WEBPAGE, 2, true);
-        if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
-        BaseTopic impressum = as.getRelatedTopic(workspaceId, 
-          KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, TOPICTYPE_WEBPAGE, 2, true);
-        if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
-        //
-        object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + workspaceName + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;logo\&quot;: \&quot;&quot; + logoURL + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;imprint\&quot;: \&quot;&quot; + impressumURL + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;homepage\&quot;: \&quot;&quot; + homepageURL + &quot;\&quot;&quot;);
-        object.append(&quot;}&quot;);
-        return object.toString();
-    }
+	private String createWorkspaceInfos(String workspaceId) {
+		StringBuffer object = new StringBuffer();
+		String workspaceName = as.getTopicProperty(workspaceId, 1, PROPERTY_NAME);
+		String logoURL = &quot;&quot;;
+		String impressumURL = &quot;&quot;;
+		String homepageURL = &quot;&quot;;
+		//
+		BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
+		if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
+		BaseTopic homepage = as.getRelatedTopic(workspaceId, 
+				KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK, TOPICTYPE_WEBPAGE, 2, true);
+		if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
+		BaseTopic impressum = as.getRelatedTopic(workspaceId, 
+				KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, TOPICTYPE_WEBPAGE, 2, true);
+		if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
+		//
+		object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + workspaceName + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;logo\&quot;: \&quot;&quot; + logoURL + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;imprint\&quot;: \&quot;&quot; + impressumURL + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;homepage\&quot;: \&quot;&quot; + homepageURL + &quot;\&quot;&quot;);
+		object.append(&quot;}&quot;);
+		return object.toString();
+	}
 
 
-    private String createCityMaps(String workspaceId)
-    {
-        StringBuffer object = new StringBuffer();
-        String workspaceName = as.getTopicProperty(workspaceId, 1, PROPERTY_NAME);
-        BaseTopic wsMap = as.getRelatedTopic(workspaceId, ASSOCTYPE_AGGREGATION, TOPICTYPE_TOPICMAP, 2, true);
-        //
-        object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + workspaceName + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + workspaceId + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;maps\&quot;: [&quot;);
-        Vector cityMaps = cm.getViewTopics(wsMap.getID(), 1, TOPICTYPE_CITYMAP);
-        System.out.println(&quot;   &gt; found : &quot; + cityMaps.size() + &quot; citymaps&quot;);
-        for(int p = 0; p &lt; cityMaps.size(); p++) {
-            BaseTopic cityMap = (BaseTopic) cityMaps.get(p);
-            String id, name, webAlias = &quot;&quot;;
-            id = cityMap.getID();
-            name = cityMap.getName();
-            webAlias = as.getTopicProperty(cityMap, PROPERTY_WEB_ALIAS);
-            object.append(&quot;{&quot;);
-            if (!webAlias.equals(&quot;&quot;)) {
-              object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + id + &quot;\&quot;, &quot;);
-              object.append(&quot;\&quot;name\&quot;: \&quot;&quot; + toJSON(name) + &quot;\&quot;, &quot;);
-              object.append(&quot;\&quot;alias\&quot;: \&quot;&quot; + webAlias + &quot;\&quot; &quot;);
-              //
-            }
-            if(cityMaps.indexOf(cityMap) == cityMaps.size() - 1)
-                  object.append(&quot;}&quot;);
-              else
-                  object.append(&quot;},&quot;);
-        }
-        object.append(&quot;]&quot;);
-        object.append(&quot;}&quot;);
-        return object.toString();
-    }
+	private String createCityMaps(String workspaceId) {
+		StringBuffer object = new StringBuffer();
+		String workspaceName = as.getTopicProperty(workspaceId, 1, PROPERTY_NAME);
+		BaseTopic wsMap = as.getRelatedTopic(workspaceId, ASSOCTYPE_AGGREGATION, TOPICTYPE_TOPICMAP, 2, true);
+		//
+		object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + workspaceName + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + workspaceId + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;maps\&quot;: [&quot;);
+		Vector cityMaps = cm.getViewTopics(wsMap.getID(), 1, TOPICTYPE_CITYMAP);
+		System.out.println(&quot;   &gt; found : &quot; + cityMaps.size() + &quot; citymaps&quot;);
+		for(int p = 0; p &lt; cityMaps.size(); p++) {
+			BaseTopic cityMap = (BaseTopic) cityMaps.get(p);
+			String id, name, webAlias = &quot;&quot;;
+			id = cityMap.getID();
+			name = cityMap.getName();
+			webAlias = as.getTopicProperty(cityMap, PROPERTY_WEB_ALIAS);
+			object.append(&quot;{&quot;);
+			if (!webAlias.equals(&quot;&quot;)) {
+				object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + id + &quot;\&quot;, &quot;);
+				object.append(&quot;\&quot;name\&quot;: \&quot;&quot; + toJSON(name) + &quot;\&quot;, &quot;);
+				object.append(&quot;\&quot;alias\&quot;: \&quot;&quot; + webAlias + &quot;\&quot; &quot;);
+				//
+			}
+			if(cityMaps.indexOf(cityMap) == cityMaps.size() - 1)
+				object.append(&quot;}&quot;);
+			else
+				object.append(&quot;},&quot;);
+		}
+		object.append(&quot;]&quot;);
+		object.append(&quot;}&quot;);
+		return object.toString();
+	}
 
-    private String createMobileCityMaps()
-    {
-        StringBuffer object = new StringBuffer();
-        Hashtable propertyFilter = new Hashtable();
-        propertyFilter.put(PROPERTY_MOBILE_CITYMAP, &quot;on&quot;);
-        Vector mobileCityMaps = cm.getTopics(&quot;tt-ka-stadtplan&quot;, propertyFilter);
-        System.out.println(&quot;Requesting mobile citymaps, found &quot; + mobileCityMaps.size() + &quot; checked for mobile-client&quot;);
-        //
-        object.append(&quot;{\&quot;name\&quot;: \&quot;Mobile Stadtpl&auml;ne im KiezAtlas\&quot;,&quot;);
-        object.append(&quot;\&quot;id\&quot;: \&quot;0\&quot;,&quot;);
-        object.append(&quot;\&quot;maps\&quot;: [&quot;);
-        for(int p = 0; p &lt; mobileCityMaps.size(); p++) {
-            BaseTopic cityMap = (BaseTopic) mobileCityMaps.get(p);
-            String id, name, webAlias = &quot;&quot;;
-            id = cityMap.getID();
-            name = cityMap.getName();
-            webAlias = as.getTopicProperty(cityMap, PROPERTY_WEB_ALIAS);
-            object.append(&quot;{&quot;);
-            // if citymaps have their &quot;mobile citymap&quot;-flag set
-            if (!webAlias.equals(&quot;&quot;)) {
-              object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + id + &quot;\&quot;, &quot;);
-              object.append(&quot;\&quot;name\&quot;: \&quot;&quot; + toJSON(name) + &quot;\&quot;, &quot;);
-              object.append(&quot;\&quot;alias\&quot;: \&quot;&quot; + webAlias + &quot;\&quot; &quot;);
-              //
-            }
-            if(mobileCityMaps.indexOf(cityMap) == mobileCityMaps.size() - 1)
-                  object.append(&quot;}&quot;);
-              else
-                  object.append(&quot;},&quot;);
-        }
-        object.append(&quot;]&quot;);
-        object.append(&quot;}&quot;);
-        return object.toString();
-    }
+	private String createMobileCityMaps() {
+		StringBuffer object = new StringBuffer();
+		Hashtable propertyFilter = new Hashtable();
+		propertyFilter.put(PROPERTY_MOBILE_CITYMAP, &quot;on&quot;);
+		Vector mobileCityMaps = cm.getTopics(&quot;tt-ka-stadtplan&quot;, propertyFilter);
+		System.out.println(&quot;Requesting mobile citymaps, found &quot; + mobileCityMaps.size() + &quot; checked for mobile-client&quot;);
+		//
+		object.append(&quot;{\&quot;name\&quot;: \&quot;Mobile Stadtpl&auml;ne im KiezAtlas\&quot;,&quot;);
+		object.append(&quot;\&quot;id\&quot;: \&quot;0\&quot;,&quot;);
+		object.append(&quot;\&quot;maps\&quot;: [&quot;);
+		for(int p = 0; p &lt; mobileCityMaps.size(); p++) {
+			BaseTopic cityMap = (BaseTopic) mobileCityMaps.get(p);
+			String id, name, webAlias = &quot;&quot;;
+			id = cityMap.getID();
+			name = cityMap.getName();
+			webAlias = as.getTopicProperty(cityMap, PROPERTY_WEB_ALIAS);
+			object.append(&quot;{&quot;);
+			// if citymaps have their &quot;mobile citymap&quot;-flag set
+			if (!webAlias.equals(&quot;&quot;)) {
+				object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + id + &quot;\&quot;, &quot;);
+				object.append(&quot;\&quot;name\&quot;: \&quot;&quot; + toJSON(name) + &quot;\&quot;, &quot;);
+				object.append(&quot;\&quot;alias\&quot;: \&quot;&quot; + webAlias + &quot;\&quot; &quot;);
+				//
+			}
+			if(mobileCityMaps.indexOf(cityMap) == mobileCityMaps.size() - 1)
+				object.append(&quot;}&quot;);
+			else
+				object.append(&quot;},&quot;);
+		}
+		object.append(&quot;]&quot;);
+		object.append(&quot;}&quot;);
+		return object.toString();
+	}
 
-    private String createSlimGeoObject(BaseTopic topic, Vector criterias, StringBuffer messages)
-    {
-        StringBuffer object = new StringBuffer();
-        //
-        String latitude = as.getTopicProperty(topic, &quot;LAT&quot;); // ### get an interface place for this final string value
-        String longnitude = as.getTopicProperty(topic, &quot;LONG&quot;); // ### get an interface place for this final string
-        String originId = as.getTopicProperty(topic, PROPERTY_PROJECT_ORIGIN_ID);
-        if(latitude.equals(&quot;&quot;) &amp;&amp; longnitude.equals(&quot;&quot;))
-        {
-            latitude = &quot;0.0&quot;;
-            longnitude = &quot;0.0&quot;;
-        }
-        String name = topic.getName();
-        name = toJSON(name);
-        //}
-        object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + name + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + topic.getID() + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;originId\&quot;: \&quot;&quot; + originId + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;lat\&quot;: \&quot;&quot; + latitude + &quot;\&quot;,&quot;);
-        object.append(&quot;\&quot;long\&quot;: \&quot;&quot; + longnitude + &quot;\&quot;,&quot;);
-        // System.out.println(&quot;&gt;&gt;&gt; createCritCatList(&quot; + topic.getID()+&quot;) ...&quot;);
-        object.append(&quot;\&quot;criterias\&quot;: &quot; + createTopicCategorizations(topic.getID(), criterias));
-        object.append(&quot;}&quot;);
-        return object.toString();
-    }
+	private String createSlimGeoObject(BaseTopic topic, Vector criterias, StringBuffer messages) {
+		StringBuffer object = new StringBuffer();
+		//
+		String latitude = as.getTopicProperty(topic, &quot;LAT&quot;); // ### get an interface place for this final string value
+		String longnitude = as.getTopicProperty(topic, &quot;LONG&quot;); // ### get an interface place for this final string
+		String originId = as.getTopicProperty(topic, PROPERTY_PROJECT_ORIGIN_ID);
+		if(latitude.equals(&quot;&quot;) &amp;&amp; longnitude.equals(&quot;&quot;)) {
+			latitude = &quot;0.0&quot;;
+			longnitude = &quot;0.0&quot;;
+		}
+		String name = topic.getName();
+		name = toJSON(name);
+		//}
+		object.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + name + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;id\&quot;: \&quot;&quot; + topic.getID() + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;originId\&quot;: \&quot;&quot; + originId + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;lat\&quot;: \&quot;&quot; + latitude + &quot;\&quot;,&quot;);
+		object.append(&quot;\&quot;long\&quot;: \&quot;&quot; + longnitude + &quot;\&quot;,&quot;);
+		// System.out.println(&quot;&gt;&gt;&gt; createCritCatList(&quot; + topic.getID()+&quot;) ...&quot;);
+		object.append(&quot;\&quot;criterias\&quot;: &quot; + createTopicCategorizations(topic.getID(), criterias));
+		object.append(&quot;}&quot;);
+		return object.toString();
+	}
 
-    /**
-     * Serializes TopicBean into JSON
-     *
-     * @param topic
-     * @param messages
-     * @return
-     */
-    private String createGeoObjectBean(BaseTopic topic, StringBuffer messages) {
-        StringBuffer bean = new StringBuffer();
-        //
-        TopicBean topicBean = as.createTopicBean(topic.getID(), 1);
-        removeCredentialInformation(topicBean);
-        String topicName = removeQuotationMarksFromNames(topicBean.name);
-        bean.append(&quot;{\&quot;id\&quot;: \&quot;&quot; + topicBean.id + &quot;\&quot;,&quot;);
-        bean.append(&quot;\&quot;name\&quot;: \&quot;&quot; + topicName + &quot;\&quot;,&quot;);
-        bean.append(&quot;\&quot;icon\&quot;: \&quot;&quot; + topicBean.icon + &quot;\&quot;,&quot;);
-        bean.append(&quot;\&quot;properties\&quot;: [&quot;);
-        Vector properties = topicBean.fields;
-        for(int p = 0; p &lt; properties.size(); p++)
-        {
-            TopicBeanField field = (TopicBeanField)properties.get(p);
-            bean.append(&quot;{\&quot;type\&quot;: \&quot;&quot; + field.type + &quot;\&quot;, &quot;);
-            bean.append(&quot;\&quot;name\&quot;: \&quot;&quot; + field.name + &quot;\&quot;, &quot;);
-            bean.append(&quot;\&quot;label\&quot;: \&quot;&quot; + field.label + &quot;\&quot;, &quot;);
-            if(field.type == 0) {
-                String value = field.value;
-                value = toJSON(value);
-                bean.append(&quot;\&quot;value\&quot;:  \&quot;&quot; + value + &quot;\&quot;&quot;);
-            } else {
-                Vector relatedFields = field.values;
-                if (relatedFields.size() == 0) {
-                    bean.append(&quot;\&quot;values\&quot;: []&quot;);
-                } else {
-                    bean.append(&quot;\&quot;values\&quot;: [&quot;);
-                    for (int r = 0; r &lt; relatedFields.size(); r++) {
-                        BaseTopic relatedTopic = (BaseTopic) relatedFields.get(r);
-                        bean.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + relatedTopic.getName() + &quot;\&quot;,&quot;);
-                        // ### geoObject has it's own icon ?
-                        bean.append(&quot;\&quot;icon\&quot;: \&quot;&quot; + as.getLiveTopic(relatedTopic).getIconfile() + &quot;\&quot;}&quot;);
-                        if ( r == relatedFields.size()-1 )  {
-                            bean.append(&quot;]&quot;);
-                        } else {
-                            bean.append(&quot;, &quot;);
-                        }
-                    }
-                }
-            }
-            if(properties.indexOf(field) == properties.size() - 1)
-                bean.append(&quot;}&quot;);
-            else
-                bean.append(&quot;},&quot;);
-        }
-        bean.append(&quot;]&quot;);
-        bean.append(&quot;}&quot;);
-        return bean.toString();
-    }
+	/**
+	 * Serializes TopicBean into JSON
+	 *
+	 * @param topic
+	 * @param messages
+	 * @return
+	 */
+	private String createGeoObjectBean(BaseTopic topic, StringBuffer messages) {
+		StringBuffer bean = new StringBuffer();
+		//
+		TopicBean topicBean = as.createTopicBean(topic.getID(), 1);
+		removeCredentialInformation(topicBean);
+		String topicName = removeQuotationMarksFromNames(topicBean.name);
+		bean.append(&quot;{\&quot;id\&quot;: \&quot;&quot; + topicBean.id + &quot;\&quot;,&quot;);
+		bean.append(&quot;\&quot;name\&quot;: \&quot;&quot; + topicName + &quot;\&quot;,&quot;);
+		bean.append(&quot;\&quot;icon\&quot;: \&quot;&quot; + topicBean.icon + &quot;\&quot;,&quot;);
+		bean.append(&quot;\&quot;properties\&quot;: [&quot;);
+		Vector properties = topicBean.fields;
+		for(int p = 0; p &lt; properties.size(); p++) {
+			TopicBeanField field = (TopicBeanField)properties.get(p);
+			bean.append(&quot;{\&quot;type\&quot;: \&quot;&quot; + field.type + &quot;\&quot;, &quot;);
+			bean.append(&quot;\&quot;name\&quot;: \&quot;&quot; + field.name + &quot;\&quot;, &quot;);
+			bean.append(&quot;\&quot;label\&quot;: \&quot;&quot; + field.label + &quot;\&quot;, &quot;);
+			if(field.type == 0) {
+				String value = field.value;
+				value = toJSON(value);
+				bean.append(&quot;\&quot;value\&quot;:  \&quot;&quot; + value + &quot;\&quot;&quot;);
+			} else {
+				Vector relatedFields = field.values;
+				if (relatedFields.size() == 0) {
+					bean.append(&quot;\&quot;values\&quot;: []&quot;);
+				} else {
+					bean.append(&quot;\&quot;values\&quot;: [&quot;);
+					for (int r = 0; r &lt; relatedFields.size(); r++) {
+						BaseTopic relatedTopic = (BaseTopic) relatedFields.get(r);
+						bean.append(&quot;{\&quot;name\&quot;: \&quot;&quot; + relatedTopic.getName() + &quot;\&quot;,&quot;);
+						// ### geoObject has it's own icon ?
+						bean.append(&quot;\&quot;icon\&quot;: \&quot;&quot; + as.getLiveTopic(relatedTopic).getIconfile() + &quot;\&quot;}&quot;);
+						if ( r == relatedFields.size()-1 )  {
+							bean.append(&quot;]&quot;);
+						} else {
+							bean.append(&quot;, &quot;);
+						}
+					}
+				}
+			}
+			if(properties.indexOf(field) == properties.size() - 1)
+				bean.append(&quot;}&quot;);
+			else
+				bean.append(&quot;},&quot;);
+		}
+		bean.append(&quot;]&quot;);
+		bean.append(&quot;}&quot;);
+		return bean.toString();
+	}
 
-    private TopicBean removeCredentialInformation(TopicBean topicBean) {
-        topicBean.removeFieldsContaining(PROPERTY_PASSWORD);
-        topicBean.removeFieldsContaining(PROPERTY_OWNER_ID);
-        topicBean.removeFieldsContaining(PROPERTY_WEB_ALIAS);
-        topicBean.removeFieldsContaining(PROPERTY_LAST_MODIFIED);
-        //
-        return topicBean;
-    }
+	private TopicBean removeCredentialInformation(TopicBean topicBean) {
+		topicBean.removeFieldsContaining(PROPERTY_PASSWORD);
+		topicBean.removeFieldsContaining(PROPERTY_OWNER_ID);
+		topicBean.removeFieldsContaining(PROPERTY_WEB_ALIAS);
+		topicBean.removeFieldsContaining(PROPERTY_LAST_MODIFIED);
+		//
+		return topicBean;
+	}
 
-    /**
-     * creates a list of categorizations for each slim topic
-     * checks for each criteria type if one is directly associated with the category
-     *
-     * @param topicId
-     * @param workspaceId
-     * @return
-     */
-    private String createTopicCategorizations(String topicId, Vector criterias)
-    {
-        StringBuffer catList = new StringBuffer(&quot;[&quot;);
-        BaseTopic topic = cm.getTopic(topicId, 1);
-        for(int i = 0; i &lt; criterias.size(); i++) {
-            BaseTopic criteria = (BaseTopic) criterias.get(i);
-            // which topics are related and are of type criteria
-            Vector categories = as.getRelatedTopics(topic.getID(), &quot;at-association&quot;, criteria.getID(), 2);
-            int andex;
-            if(categories.size() == 0) {
-                catList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + criteria.getID() + &quot;\&quot;, &quot;);
-                catList.append(&quot;\&quot;categories\&quot;: []&quot;);
-                andex = criterias.indexOf(criteria);
-                // awkyard
-                if(andex == criterias.size() - 1)
-                    catList.append(&quot;}]&quot;);
-                else
-                    catList.append(&quot;},&quot;);
-                continue;
-            }
-            catList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + criteria.getID() + &quot;\&quot;, &quot;);
-            catList.append(&quot;\&quot;categories\&quot;: [&quot;);
-            for(int c = 0; c &lt; categories.size(); c++) {
-                BaseTopic cat = (BaseTopic)categories.get(c);
-                int index = categories.indexOf(cat);
-                // awkyard
-                if(index == categories.size() - 1)
-                    catList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;&quot;);
-                else
-                    catList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;, &quot;);
-            }
-            int c = criterias.indexOf(criteria);
-            if(c == criterias.size() - 1)
-                catList.append(&quot;]}]&quot;);
-            else
-                catList.append(&quot;]},&quot;);
-        }
-        if (criterias.size() == 0) catList.append(&quot;]&quot;);
-        return catList.toString();
-    }
+	/**
+	 * creates a list of categorizations for each slim topic
+	 * checks for each criteria type if one is directly associated with the category
+	 *
+	 * @param topicId
+	 * @param workspaceId
+	 * @return
+	 */
+	private String createTopicCategorizations(String topicId, Vector criterias) {
+		StringBuffer catList = new StringBuffer(&quot;[&quot;);
+		BaseTopic topic = cm.getTopic(topicId, 1);
+		for(int i = 0; i &lt; criterias.size(); i++) {
+			BaseTopic criteria = (BaseTopic) criterias.get(i);
+			// which topics are related and are of type criteria
+			Vector categories = as.getRelatedTopics(topic.getID(), &quot;at-association&quot;, criteria.getID(), 2);
+			int andex;
+			if(categories.size() == 0) {
+				catList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + criteria.getID() + &quot;\&quot;, &quot;);
+				catList.append(&quot;\&quot;categories\&quot;: []&quot;);
+				andex = criterias.indexOf(criteria);
+				// awkyard
+				if(andex == criterias.size() - 1)
+					catList.append(&quot;}]&quot;);
+				else
+					catList.append(&quot;},&quot;);
+				continue;
+			}
+			catList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + criteria.getID() + &quot;\&quot;, &quot;);
+			catList.append(&quot;\&quot;categories\&quot;: [&quot;);
+			for(int c = 0; c &lt; categories.size(); c++) {
+				BaseTopic cat = (BaseTopic)categories.get(c);
+				int index = categories.indexOf(cat);
+				// awkyard
+				if(index == categories.size() - 1)
+					catList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;&quot;);
+				else
+					catList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;, &quot;);
+			}
+			int c = criterias.indexOf(criteria);
+			if(c == criterias.size() - 1)
+				catList.append(&quot;]}]&quot;);
+			else
+				catList.append(&quot;]},&quot;);
+		}
+		if (criterias.size() == 0) catList.append(&quot;]&quot;);
+		return catList.toString();
+	}
 
-    /**
-     * list of all categorizations for one workspace
-     *
-     * @param workspaceId
-     * @return
-     */
-    private String createCritCatSystemList(String mapId)
-    {
-        StringBuffer objectList = new StringBuffer();
-        objectList.append(&quot;[&quot;);
-        // Vector criterias = getKiezCriteriaTypes(workspaceId);
-        CityMapTopic mapTopic = (CityMapTopic) as.getLiveTopic(mapId, 1);
-        SearchCriteria[] crits = mapTopic.getSearchCriterias();
-        // Vector collectedCrits = new Vector();
-        for (int i = 0; i &lt; crits.length; i++) {
-            SearchCriteria searchCriteria = crits[i];
-            // collectedCrits.add(searchCriteria.criteria.getID());
-            objectList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + searchCriteria.criteria.getID() + &quot;\&quot;, &quot;);
-            objectList.append(&quot;\&quot;critName\&quot;: \&quot;&quot; + toJSON(searchCriteria.criteria.getName()) + &quot;\&quot;, &quot;);
-            objectList.append(&quot;\&quot;categories\&quot;: [&quot;);
-            // sorted query
-            Vector categories = cm.getTopics(searchCriteria.criteria.getID(), null, new Hashtable(), null, null, true);
-            for (int c = 0; c &lt; categories.size(); c++) {
-                objectList.append(&quot;{&quot;);
-                objectList.append(&quot;\&quot;catId\&quot;:&quot;);
-                BaseTopic cat = (BaseTopic)categories.get(c);
-                // System.out.println(&quot;&gt;&gt;&gt;&gt; category(&quot; + cat.getName() +&quot; icon: &quot;+ as.getLiveTopic(cat).getIconfile());
-                objectList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;, &quot;);
-                objectList.append(&quot;\&quot;catName\&quot;:&quot;);
-                objectList.append(&quot;\&quot;&quot; + toJSON(cat.getName()) + &quot;\&quot;, &quot;);
-                objectList.append(&quot;\&quot;catIcon\&quot;:&quot;);
-                objectList.append(&quot;\&quot;&quot; + as.getLiveTopic(cat).getIconfile() + &quot;\&quot;&quot;);
-                //
-                int index = categories.indexOf(cat);
-                if(index == categories.size() - 1) {
-                    objectList.append(&quot;}&quot;);
-                } else {
-                    objectList.append(&quot;},&quot;);
-                }
-            }
-            if(i == crits.length - 1)
-                objectList.append(&quot;]}&quot;);
-            else
-                objectList.append(&quot;]},&quot;);
-        }
-        objectList.append(&quot;]&quot;);
-        // System.out.println(&quot;list is: &quot; + objectList);
-        return objectList.toString();
-    }
+	/**
+	 * list of all categorizations for one workspace
+	 *
+	 * @param workspaceId
+	 * @return
+	 */
+	private String createCritCatSystemList(String mapId) {
+		StringBuffer objectList = new StringBuffer();
+		objectList.append(&quot;[&quot;);
+		// Vector criterias = getKiezCriteriaTypes(workspaceId);
+		CityMapTopic mapTopic = (CityMapTopic) as.getLiveTopic(mapId, 1);
+		SearchCriteria[] crits = mapTopic.getSearchCriterias();
+		// Vector collectedCrits = new Vector();
+		for (int i = 0; i &lt; crits.length; i++) {
+			SearchCriteria searchCriteria = crits[i];
+			// collectedCrits.add(searchCriteria.criteria.getID());
+			objectList.append(&quot;{\&quot;critId\&quot;: \&quot;&quot; + searchCriteria.criteria.getID() + &quot;\&quot;, &quot;);
+			objectList.append(&quot;\&quot;critName\&quot;: \&quot;&quot; + toJSON(searchCriteria.criteria.getName()) + &quot;\&quot;, &quot;);
+			objectList.append(&quot;\&quot;categories\&quot;: [&quot;);
+			// sorted query
+			Vector categories = cm.getTopics(searchCriteria.criteria.getID(), null, new Hashtable(), null, null, true);
+			for (int c = 0; c &lt; categories.size(); c++) {
+				objectList.append(&quot;{&quot;);
+				objectList.append(&quot;\&quot;catId\&quot;:&quot;);
+				BaseTopic cat = (BaseTopic)categories.get(c);
+				// System.out.println(&quot;&gt;&gt;&gt;&gt; category(&quot; + cat.getName() +&quot; icon: &quot;+ as.getLiveTopic(cat).getIconfile());
+				objectList.append(&quot;\&quot;&quot; + cat.getID() + &quot;\&quot;, &quot;);
+				objectList.append(&quot;\&quot;catName\&quot;:&quot;);
+				objectList.append(&quot;\&quot;&quot; + toJSON(cat.getName()) + &quot;\&quot;, &quot;);
+				objectList.append(&quot;\&quot;catIcon\&quot;:&quot;);
+				objectList.append(&quot;\&quot;&quot; + as.getLiveTopic(cat).getIconfile() + &quot;\&quot;&quot;);
+				//
+				int index = categories.indexOf(cat);
+				if(index == categories.size() - 1) {
+					objectList.append(&quot;}&quot;);
+				} else {
+					objectList.append(&quot;},&quot;);
+				}
+			}
+			if(i == crits.length - 1)
+				objectList.append(&quot;]}&quot;);
+			else
+				objectList.append(&quot;]},&quot;);
+		}
+		objectList.append(&quot;]&quot;);
+		// System.out.println(&quot;list is: &quot; + objectList);
+		return objectList.toString();
+	}
 
-    /**
-     * simply retrieves the topics assigned to a workspace which are used
-     * for navigation in web-frontends
-     *
-     * @param workspaceId
-     * @return
-     */
-    private Vector getKiezCriteriaTypes(String workspaceId) {
-        //
-        Vector criterias = new Vector();
-        TypeTopic critType = as.type(&quot;tt-ka-kriterium&quot;, 1);
-        Vector subtypes = critType.getSubtypeIDs();
-        Vector workspacetypes = as.getRelatedTopics(workspaceId, &quot;at-uses&quot;, TOPICTYPE_TOPICTYPE, 2, true, true);
-        for ( int i = 0; i &lt; workspacetypes.size(); i++ ) {
-            BaseTopic topic = (BaseTopic)workspacetypes.get(i);
-            for ( int a = 0; a &lt; subtypes.size(); a++ ) {
-                String derivedOne = (String)subtypes.get(a);
-                if ( derivedOne.equals(topic.getID()) ) {
-                    // System.out.println(&quot;&gt;&gt;&gt; use criteria (&quot; + derivedOne + &quot;) &quot; + topic.getName());
-                    criterias.add(topic);
-                }
-            }
-        }
-        return criterias;
-    }
+	/**
+	 * simply retrieves the topics assigned to a workspace which are used
+	 * for navigation in web-frontends
+	 *
+	 * @param workspaceId
+	 * @return
+	 */
+	private Vector getKiezCriteriaTypes(String workspaceId) {
+		//
+		Vector criterias = new Vector();
+		TypeTopic critType = as.type(&quot;tt-ka-kriterium&quot;, 1);
+		Vector subtypes = critType.getSubtypeIDs();
+		Vector workspacetypes = as.getRelatedTopics(workspaceId, &quot;at-uses&quot;, TOPICTYPE_TOPICTYPE, 2, true, true);
+		for ( int i = 0; i &lt; workspacetypes.size(); i++ ) {
+			BaseTopic topic = (BaseTopic)workspacetypes.get(i);
+			for ( int a = 0; a &lt; subtypes.size(); a++ ) {
+				String derivedOne = (String)subtypes.get(a);
+				if ( derivedOne.equals(topic.getID()) ) {
+					// System.out.println(&quot;&gt;&gt;&gt; use criteria (&quot; + derivedOne + &quot;) &quot; + topic.getName());
+					criterias.add(topic);
+				}
+			}
+		}
+		return criterias;
+	}
 
-    // ### ToDo: as.getLiveTopic().getSearchCriteria();
-    
-    /**
-     * returns null if no topictype whihc is assigned to the given workspace,
-     * is a subtype of &quot;GeoObjectTopic&quot;
-     *
-     * @param workspaceId
-     * @return
-     */
-    private BaseTopic getWorkspaceGeoType(String workspaceId) {
-        //
-        TypeTopic geotype = as.type(TOPICTYPE_KIEZ_GEO, 1);
-        Vector subtypes = geotype.getSubtypeIDs();
-        Vector workspacetypes = as.getRelatedTopics(workspaceId, ASSOCTYPE_USES, 2);
-        int i;
-        for (i = 0; i &lt; workspacetypes.size(); i++) {
-            BaseTopic topic = (BaseTopic) workspacetypes.get(i);
-            int a;
-            for (a = 0; a &lt; subtypes.size(); a++) {
-                // System.out.println(&quot; counter: &quot; + a);
-                String derivedOne = (String) subtypes.get(a);
-                // System.out.println(&quot;    &quot; + derivedOne.getID() + &quot;:&quot; + derivedOne.getName());
-                if (derivedOne.equals(topic.getID())) {
-                    // System.out.println(&quot; found geoType &quot; + topic.getID() + &quot;:&quot; + topic.getName());
-                    return topic;
-                }
-            }
-        }
-        return null;
-    }
+	// ### ToDo: as.getLiveTopic().getSearchCriteria();
 
-    private boolean hasQuotationMarks(String value)
-    {
-        return value.indexOf(&quot;\&quot;&quot;) != -1;
-    }
+	/**
+	 * returns null if no topictype whihc is assigned to the given workspace,
+	 * is a subtype of &quot;GeoObjectTopic&quot;
+	 *
+	 * @param workspaceId
+	 * @return
+	 */
+	private BaseTopic getWorkspaceGeoType(String workspaceId) {
+		//
+		TypeTopic geotype = as.type(TOPICTYPE_KIEZ_GEO, 1);
+		Vector subtypes = geotype.getSubtypeIDs();
+		Vector workspacetypes = as.getRelatedTopics(workspaceId, ASSOCTYPE_USES, 2);
+		int i;
+		for (i = 0; i &lt; workspacetypes.size(); i++) {
+			BaseTopic topic = (BaseTopic) workspacetypes.get(i);
+			int a;
+			for (a = 0; a &lt; subtypes.size(); a++) {
+				// System.out.println(&quot; counter: &quot; + a);
+				String derivedOne = (String) subtypes.get(a);
+				// System.out.println(&quot;    &quot; + derivedOne.getID() + &quot;:&quot; + derivedOne.getName());
+				if (derivedOne.equals(topic.getID())) {
+					// System.out.println(&quot; found geoType &quot; + topic.getID() + &quot;:&quot; + topic.getName());
+					return topic;
+				}
+			}
+		}
+		return null;
+	}
 
-    private String removeQuotationMarksFromNames(String name) {
-        name = name.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);
-        return name;
-    }
+	private boolean hasQuotationMarks(String value) {
+		return value.indexOf(&quot;\&quot;&quot;) != -1;
+	}
 
-    private String removeControlChars(String value) {
-        // html uses carriage-return, line-feed and horizontal tab
-        value = value.replaceAll(&quot;\r&quot;, &quot;\\\\r&quot;);
-        value = value.replaceAll(&quot;\n&quot;, &quot;\\\\n&quot;);
-        value = value.replaceAll(&quot;\t&quot;, &quot;\\\\t&quot;);
-        value = value.replaceAll(&quot;\f&quot;, &quot;\\\\f&quot;);
-        value = value.replaceAll(&quot;\b&quot;, &quot;\\\\b&quot;);
-        value = value.replaceAll(&quot;\&quot;&quot;, &quot;\\\\\&quot;&quot;);
-        //System.out.println(&quot;replaced value is : &quot; + value);
-        return value;
-    }
+	private String removeQuotationMarksFromNames(String name) {
+		name = name.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);
+		return name;
+	}
 
-    private String toJSON(String text) {
-        // strip HTML tags
-        text = text.replaceAll(&quot;&lt;html&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;/html&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;head&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;/head&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;body&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;/body&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;p&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;p style=\&quot;margin-top: 0\&quot;&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;&lt;/p&gt;&quot;, &quot;&quot;);
-        text = text.replaceAll(&quot;'&quot;, &quot;\'&quot;);
-        text = text.replaceAll(&quot;&amp;&quot;, &quot;&amp;&quot;);
-        // text = text.replaceAll(&quot;\'&quot;, &quot;&quot;);
-        // convert HTML entities
-        text = toUnicode(text);
-        //
-        text = text.trim();
-        // JSON conformity
-        text = removeControlChars(text);
-        //
-        return text;
-    }
+	private String removeControlChars(String value) {
+		// html uses carriage-return, line-feed and horizontal tab
+		value = value.replaceAll(&quot;\r&quot;, &quot;\\\\r&quot;);
+		value = value.replaceAll(&quot;\n&quot;, &quot;\\\\n&quot;);
+		value = value.replaceAll(&quot;\t&quot;, &quot;\\\\t&quot;);
+		value = value.replaceAll(&quot;\f&quot;, &quot;\\\\f&quot;);
+		value = value.replaceAll(&quot;\b&quot;, &quot;\\\\b&quot;);
+		value = value.replaceAll(&quot;\&quot;&quot;, &quot;\\\\\&quot;&quot;);
+		//System.out.println(&quot;replaced value is : &quot; + value);
+		return value;
+	}
 
-    private String toUnicode(String text)
-    {
-        StringBuffer buffer = new StringBuffer();
-        Pattern p = Pattern.compile(&quot;&amp;#(\\d+);&quot;);
-        Matcher m = p.matcher(text);
-        while (m.find()) {
-            int c = Integer.parseInt(m.group(1));
-            m.appendReplacement(buffer, Character.toString((char) c));
-        }
-        m.appendTail(buffer);
-        return buffer.toString();
-    }
+	private String toJSON(String text) {
+		// strip HTML tags
+		text = text.replaceAll(&quot;&lt;html&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;/html&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;head&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;/head&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;body&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;/body&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;p&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;p style=\&quot;margin-top: 0\&quot;&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;&lt;/p&gt;&quot;, &quot;&quot;);
+		text = text.replaceAll(&quot;'&quot;, &quot;\'&quot;);
+		text = text.replaceAll(&quot;&amp;&quot;, &quot;&amp;&quot;);
+		// text = text.replaceAll(&quot;\'&quot;, &quot;&quot;);
+		// convert HTML entities
+		text = toUnicode(text);
+		//
+		text = text.trim();
+		// JSON conformity
+		text = removeControlChars(text);
+		//
+		return text;
+	}
 
+	private String toUnicode(String text) {
+		StringBuffer buffer = new StringBuffer();
+		Pattern p = Pattern.compile(&quot;&amp;#(\\d+);&quot;);
+		Matcher m = p.matcher(text);
+		while (m.find()) {
+			int c = Integer.parseInt(m.group(1));
+			m.appendReplacement(buffer, Character.toString((char) c));
+		}
+		m.appendTail(buffer);
+		return buffer.toString();
+	}
+
 }

Modified: trunk/src/de/kiezatlas/deepamehta/MapServlet.java
===================================================================
--- trunk/src/de/kiezatlas/deepamehta/MapServlet.java	2012-11-09 13:07:37 UTC (rev 108)
+++ trunk/src/de/kiezatlas/deepamehta/MapServlet.java	2012-11-09 13:43:16 UTC (rev 109)
@@ -39,107 +39,107 @@
 
 
 /**
- * Kiezatlas 1.6.7&lt;br&gt;
- * Requires DeepaMehta 2.0b8
+ * Kiezatlas 1.6.10&lt;br&gt;
+ * Requires DeepaMehta 2.0b8-rev388
  * &lt;p&gt;
- * Last change: 22.11.2010&lt;br&gt;
+ * Last change: 09.11.2012&lt;br&gt;
  * Malte Rei&szlig;ig &lt;br&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/kiezatlas-svn">mre at deepamehta.de</A>
+ * &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiezatlas-svn">mre at deepamehta.de</A>&gt;
  */
 public class MapServlet extends DeepaMehtaServlet implements KiezAtlas {
 
 
-    // --
-    // --- KiezAtlas Service Settings / Kiezatlas Labs City Map Servlet
-    // --
+	// --
+	// --- KiezAtlas Service Settings / Kiezatlas Labs City Map Servlet
+	// --
 
 
-    // private final String urlStr = &quot;<A HREF="http://www.kiezatlas.de/rpc/">http://www.kiezatlas.de/rpc/</A>&quot;;
-    private final String urlStr = &quot;<A HREF="http://localhost:8080/kiezatlas/rpc/">http://localhost:8080/kiezatlas/rpc/</A>&quot;;
-    // private final String urlStr = &quot;<A HREF="http://212.87.44.116:8080/rpc/">http://212.87.44.116:8080/rpc/</A>&quot;;
-    private final String charset = &quot;ISO-8859-1&quot;;
-    
-    String topicmapId = &quot;is-set-to-current-topicmap-id-of-request&quot;; // used by new getLastModified impl
+	// private final String urlStr = &quot;<A HREF="http://www.kiezatlas.de/rpc/">http://www.kiezatlas.de/rpc/</A>&quot;;
+	private final String urlStr = &quot;<A HREF="http://localhost:8080/kiezatlas/rpc/">http://localhost:8080/kiezatlas/rpc/</A>&quot;;
+	// private final String urlStr = &quot;<A HREF="http://212.87.44.116:8080/rpc/">http://212.87.44.116:8080/rpc/</A>&quot;;
+	private final String charset = &quot;ISO-8859-1&quot;;
 
+	String topicmapId = &quot;is-set-to-current-topicmap-id-of-request&quot;; // used by new getLastModified impl
 
 
-	protected String performAction(String action, RequestParameter params, Session session, CorporateDirectives directives)
-																									throws ServletException {
+
+	protected String performAction(String action, RequestParameter params, Session session, 
+								CorporateDirectives directives) throws ServletException {
 		if (action == null) {
-        try {
-            String pathInfo = params.getPathInfo();
-            // error check
-            if (pathInfo == null || pathInfo.length() == 1) {
-                throw new DeepaMehtaException(&quot;Fehler in URL&quot;);
-            }
-            String[] elements = pathInfo.split(&quot;/&quot;);
-            Hashtable requested = parseRequestedPath(elements);
-            if (requested != null) {
-                session.setAttribute(&quot;originId&quot;, requested.get(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
-                session.setAttribute(&quot;topicId&quot;, requested.get(&quot;geo&quot;));
-                session.setAttribute(&quot;categories&quot;, requested.get(&quot;categories&quot;));
-                session.setAttribute(&quot;baseLayer&quot;, requested.get(&quot;layer&quot;));
-                session.setAttribute(&quot;critIndex&quot;, requested.get(&quot;criteria&quot;));
-                session.setAttribute(&quot;searchTerm&quot;, requested.get(&quot;search&quot;));
-            }
-            // overrides pathinfo url settings just parsed.. for backwards compatibility reasons
-            // application states represented in URL - just passing params to javascript
-            Integer critIndex = 0;
-            if (params.getParameter(&quot;critId&quot;) != null) {
-                critIndex = Integer.parseInt(params.getParameter(&quot;critId&quot;))-1;
-            } // [0]
-            if (params.getParameter(&quot;linkTo&quot;) != null) session.setAttribute(&quot;originId&quot;, params.getParameter(&quot;linkTo&quot;)); // linkTo here for backwards compatibility rsn
-            if (params.getParameter(&quot;topicId&quot;) != null) session.setAttribute(&quot;topicId&quot;, params.getParameter(&quot;topicId&quot;));
-            if (params.getParameter(&quot;catIds&quot;) != null) session.setAttribute(&quot;categories&quot;, params.getParameter(&quot;catIds&quot;));
-            if (params.getParameter(&quot;baseLayer&quot;) != null) session.setAttribute(&quot;baseLayer&quot;, params.getParameter(&quot;baseLayer&quot;));
-            if (params.getParameter(&quot;search&quot;) != null) session.setAttribute(&quot;searchTerm&quot;, params.getParameter(&quot;search&quot;));
-            if (session.getAttribute(&quot;critIndex&quot;) == null) session.setAttribute(&quot;critIndex&quot;, critIndex);
-            //
-            String alias = pathInfo.substring(1);
-            if (pathInfo.indexOf(&quot;&amp;&quot;) != -1) {
-                alias = pathInfo.substring(1, pathInfo.indexOf(&quot;&amp;&quot;));
-            } else if (pathInfo.indexOf(&quot;/&quot;, 1) != -1) {
-                // if / behind mapname... slice map-alias out
-                alias = elements[1];
-            }
-            session.setAttribute(&quot;mapAlias&quot;, alias);
-            BaseTopic mapTopic = CityMapTopic.lookupCityMap(alias, true, as); // throwIfNotFound=true
-            setCityMap(mapTopic, session);
-            this.topicmapId = mapTopic.getID();
-            if (!CityMapTopic.isProtected(mapTopic, as)) {
-                //
-                initCityMap(session);
-                return PAGE_MAP_ATLAS;
-            } else {
-                return PAGE_MAP_LOGIN;
-            }
-        } catch (DeepaMehtaException e) {
-            System.out.println(&quot;*** BrowseServlet.performAction(): &quot; + e);
-            session.setAttribute(&quot;error&quot;, e.getMessage());
-            return PAGE_ERROR;
-        }
-    }
-    // session timeout?
-    if (getCityMap(session) == null) {
-      System.out.println(&quot;*** Session Expired ***&quot;);
-      session.setAttribute(&quot;error&quot;, &quot;Timeout: Kiezatlas wurde mehr als &quot; + 
-              ((WebSession) session).session.getMaxInactiveInterval() / 60 + &quot; Minuten nicht benutzt&quot;);
-      return PAGE_ERROR;
-    }
-    // login
-    if (action.equals(ACTION_TRY_LOGIN)) {
-      String password = params.getValue(&quot;password&quot;);
-      if (CityMapTopic.passwordCorrect(getCityMap(session), as, password)) {
-        initCityMap(session);
-        return PAGE_MAP_ATLAS;
-      } else {
-        return PAGE_MAP_LOGIN;
-      }
-    } else if (action.equals(ACTION_SEARCH)) {
-        // search
-        setSearchMode(SEARCHMODE_BY_NAME, session);
-        setSearchValue(params.getValue(&quot;search&quot;), session);
-        return PAGE_GEO_LIST;
+			try {
+				String pathInfo = params.getPathInfo();
+				// error check
+				if (pathInfo == null || pathInfo.length() == 1) {
+					throw new DeepaMehtaException(&quot;Fehler in URL&quot;);
+				}
+				String[] elements = pathInfo.split(&quot;/&quot;);
+				Hashtable requested = parseRequestedPath(elements);
+				if (requested != null) {
+					session.setAttribute(&quot;originId&quot;, requested.get(&quot;linkTo&quot;)); // linkTo here for backwards compatibil.
+					session.setAttribute(&quot;topicId&quot;, requested.get(&quot;geo&quot;));
+					session.setAttribute(&quot;categories&quot;, requested.get(&quot;categories&quot;));
+					session.setAttribute(&quot;baseLayer&quot;, requested.get(&quot;layer&quot;));
+					session.setAttribute(&quot;critIndex&quot;, requested.get(&quot;criteria&quot;));
+					session.setAttribute(&quot;searchTerm&quot;, requested.get(&quot;search&quot;));
+				}
+				// overrides pathinfo url settings just parsed.. for backwards compatibility reasons
+				// application states represented in URL - just passing params to javascript
+				Integer critIndex = 0;
+				if (params.getParameter(&quot;critId&quot;) != null) {
+					critIndex = Integer.parseInt(params.getParameter(&quot;critId&quot;))-1;
+				} // [0]
+				if (params.getParameter(&quot;linkTo&quot;) != null) session.setAttribute(&quot;originId&quot;, params.getParameter(&quot;linkTo&quot;));
+				if (params.getParameter(&quot;topicId&quot;) != null) session.setAttribute(&quot;topicId&quot;, params.getParameter(&quot;topicId&quot;));
+				if (params.getParameter(&quot;catIds&quot;) != null) session.setAttribute(&quot;categories&quot;, params.getParameter(&quot;catIds&quot;));
+				if (params.getParameter(&quot;baseLayer&quot;) != null) session.setAttribute(&quot;baseLayer&quot;, params.getParameter(&quot;baseLayer&quot;));
+				if (params.getParameter(&quot;search&quot;) != null) session.setAttribute(&quot;searchTerm&quot;, params.getParameter(&quot;search&quot;));
+				if (session.getAttribute(&quot;critIndex&quot;) == null) session.setAttribute(&quot;critIndex&quot;, critIndex);
+				//
+				String alias = pathInfo.substring(1);
+				if (pathInfo.indexOf(&quot;&amp;&quot;) != -1) {
+					alias = pathInfo.substring(1, pathInfo.indexOf(&quot;&amp;&quot;));
+				} else if (pathInfo.indexOf(&quot;/&quot;, 1) != -1) {
+					// if / behind mapname... slice map-alias out
+					alias = elements[1];
+				}
+				session.setAttribute(&quot;mapAlias&quot;, alias);
+				BaseTopic mapTopic = CityMapTopic.lookupCityMap(alias, true, as); // throwIfNotFound=true
+				setCityMap(mapTopic, session);
+				this.topicmapId = mapTopic.getID();
+				if (!CityMapTopic.isProtected(mapTopic, as)) {
+					//
+					initCityMap(session);
+					return PAGE_MAP_ATLAS;
+				} else {
+					return PAGE_MAP_LOGIN;
+				}
+			} catch (DeepaMehtaException e) {
+				System.out.println(&quot;*** BrowseServlet.performAction(): &quot; + e);
+				session.setAttribute(&quot;error&quot;, e.getMessage());
+				return PAGE_ERROR;
+			}
+		}
+		// session timeout?
+		if (getCityMap(session) == null) {
+			System.out.println(&quot;*** Session Expired ***&quot;);
+			session.setAttribute(&quot;error&quot;, &quot;Timeout: Kiezatlas wurde mehr als &quot; + 
+					((WebSession) session).session.getMaxInactiveInterval() / 60 + &quot; Minuten nicht benutzt&quot;);
+			return PAGE_ERROR;
+		}
+		// login
+		if (action.equals(ACTION_TRY_LOGIN)) {
+			String password = params.getValue(&quot;password&quot;);
+			if (CityMapTopic.passwordCorrect(getCityMap(session), as, password)) {
+				initCityMap(session);
+				return PAGE_MAP_ATLAS;
+			} else {
+				return PAGE_MAP_LOGIN;
+			}
+		// search
+		} else if (action.equals(ACTION_SEARCH)) {
+			setSearchMode(SEARCHMODE_BY_NAME, session);
+			setSearchValue(params.getValue(&quot;search&quot;), session);
+			return PAGE_GEO_LIST;
 		// show
 		} else if (action.equals(ACTION_SHOW_CATEGORIES)) {
 			String critNr = params.getValue(&quot;critNr&quot;);
@@ -168,7 +168,7 @@
 			return PAGE_GEO_LIST;
 		// info
 		} else if (action.equals(ACTION_SHOW_GEO_INFO)) {
-      // ### should also set the current HotspotMarker (e.g. after searchByCategory)
+			// ### should also set the current HotspotMarker (e.g. after searchByCategory)
 			String geoID = params.getValue(&quot;id&quot;);
 			setSelectedGeo(geoID, session);
 			TopicBean topicBean = as.createTopicBean(geoID, 1);
@@ -182,9 +182,8 @@
 				session.setAttribute(&quot;commentCount&quot;, new Integer(geo.getComments().size()));
 			}
 			return PAGE_GEO_INFO;
-		// show forum if wanted
 		}
-    return PAGE_ERROR;
+		return PAGE_ERROR;
 	}
 
 	protected void preparePage(String page, RequestParameter params, Session session, CorporateDirectives directives) {
@@ -193,8 +192,8 @@
 			Vector selectedCats = getSelectedCats(session);
 			session.setAttribute(&quot;categories&quot;, categories);
 			session.setAttribute(&quot;selectedCats&quot;, selectedCats);
-            // disable enumeration rendering
-            session.setAttribute(&quot;enumerationFlag&quot;, false);
+			// disable enumeration rendering
+			session.setAttribute(&quot;enumerationFlag&quot;, false);
 			// hotspots
 			setCategoryHotspots(session);
 			// clear marker
@@ -205,19 +204,19 @@
 			String instTypeID = getInstitutionType(session).getID();
 			String searchMode = getSearchMode(session);
 			Vector insts;
-            // enable the rendering of enumeration
-            session.setAttribute(&quot;enumerationFlag&quot;, true);
+			// enable the rendering of enumeration
+			session.setAttribute(&quot;enumerationFlag&quot;, true);
 			if (searchMode.equals(SEARCHMODE_BY_NAME)) {
 				insts = cm.getViewTopics(mapID, 1, instTypeID, getSearchValue(session));
 				// hotspots
 				setHotspots(insts, ICON_HOTSPOT, session);
-                session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;);
+				session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;);
 			} else {
 				String catID = params.getValue(&quot;id&quot;);
 				insts = cm.getRelatedViewTopics(mapID, 1, catID, ASSOCTYPE_ASSOCIATION, instTypeID, 1);	// ### copy in setCategoryHotspots()
 				// hotspots + return the index of the current CatID in the multi-dimensional hotspot vector
 				int catIndex = setSearchedCategoryHotspots(session, catID);
-                session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;+catIndex+&quot;&quot;);
+				session.setAttribute(&quot;selectedCatId&quot;, &quot;&quot;+catIndex+&quot;&quot;);
 			}
 			session.setAttribute(&quot;institutions&quot;, insts);
 			// categories &amp; addresses
@@ -250,86 +249,86 @@
 		}
 	}
 
-    protected long getLastModified(HttpServletRequest req) {
-        String dateProperty = as.getTopicProperty(this.topicmapId, 1, PROPERTY_LAST_UPDATED);
-        long lastModified = new Date().getTime();
-        if (!dateProperty.equals(&quot;&quot;)) lastModified = new Date(Long.parseLong(dateProperty)).getTime();
-        return lastModified;
-    }
+	protected long getLastModified(HttpServletRequest req) {
+		String dateProperty = as.getTopicProperty(this.topicmapId, 1, PROPERTY_LAST_UPDATED);
+		long lastModified = new Date().getTime();
+		if (!dateProperty.equals(&quot;&quot;)) lastModified = new Date(Long.parseLong(dateProperty)).getTime();
+		return lastModified;
+	}
 
-  
+
 	// *****************
 	// *** Utilities ***
 	// *****************
 
 
 
-  private String getMapTopics(String mapId, String workspaceId, Session session) {
-    String result = null;
-    try {
-        // Send data
-        URL url = new URL(urlStr);
-        String query = &quot;{\&quot;method\&quot;: \&quot;getMapTopics\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot; , \&quot;&quot; + workspaceId + &quot;\&quot;]}&quot;;
-        URLConnection connection = new URL(urlStr).openConnection();
-        connection.setDoOutput(true); // Triggers POST.
-        // connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
-        connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
-        OutputStream output = null;
-        output = connection.getOutputStream();
-        output.write(query.getBytes(charset));
-        // Get the response
-        BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
-        String line = &quot;&quot;;
-        if (rd.ready()) {
-          line = rd.readLine();
-        }
-        result = line;
-        rd.close();
-        return result;
-    } catch(UnknownHostException uke) {
-        System.out.println(&quot;*** [MapServlet] could not load the json data to import from &quot; + urlStr + &quot; message is: &quot; + uke.getMessage());
-        return null;
-        // done();
-    } catch (Exception ex) {
-        System.out.println(&quot;*** [MapServlet] Servleten countered problem: &quot; + ex.getMessage());
-        return null;
-    }
-  }
+	private String getMapTopics(String mapId, String workspaceId, Session session) {
+		String result = null;
+		try {
+			// Send data
+			URL url = new URL(urlStr);
+			String query = &quot;{\&quot;method\&quot;: \&quot;getMapTopics\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot; , \&quot;&quot; + workspaceId + &quot;\&quot;]}&quot;;
+			URLConnection connection = new URL(urlStr).openConnection();
+			connection.setDoOutput(true); // Triggers POST.
+			// connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
+			OutputStream output = null;
+			output = connection.getOutputStream();
+			output.write(query.getBytes(charset));
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
+			String line = &quot;&quot;;
+			if (rd.ready()) {
+				line = rd.readLine();
+			}
+			result = line;
+			rd.close();
+			return result;
+		} catch(UnknownHostException uke) {
+			System.out.println(&quot;*** [MapServlet] could not load the json data to import from &quot; + urlStr + &quot; message is: &quot; + uke.getMessage());
+			return null;
+			// done();
+		} catch (Exception ex) {
+			System.out.println(&quot;*** [MapServlet] Servleten countered problem: &quot; + ex.getMessage());
+			return null;
+		}
+	}
 
-  private String getKiezCriterias(String mapId, Session session) {
-    String result = null;
-    try {
-        // Send data
-        URL url = new URL(urlStr);
-        String query = &quot;{\&quot;method\&quot;: \&quot;getWorkspaceCriterias\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot;]}&quot;;
-        // url.s
-        URLConnection connection = new URL(urlStr).openConnection();
-        connection.setDoOutput(true); // Triggers POST.
-        // connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
-        connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
-        OutputStream output = null;
-        output = connection.getOutputStream();
-        output.write(query.getBytes(charset));
-        // Get the response
-        BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
-        String line = &quot;&quot;;
-        if (rd.ready()) {
-          line = rd.readLine();
-        }
-        result = line;
-        return result;
-    } catch(UnknownHostException uke) {
-        System.out.println(&quot;*** [MapServlet] could not load the json data to import from &quot; + urlStr + &quot; message is: &quot; + uke.getMessage());
-        return null;
-        // done();
-    } catch (UnsupportedEncodingException ex) {
-        System.out.println(&quot;*** [MapServlet] Servlet encountered unsupportedEncoding : &quot; + ex.getMessage());
-        return null;
-    } catch (IOException ex) {
-        System.out.println(&quot;*** [MapServlet] Servlet encountered ioException : &quot; + ex.getMessage());
-        return null;
-    }
-  }
+	private String getKiezCriterias(String mapId, Session session) {
+		String result = null;
+		try {
+			// Send data
+			URL url = new URL(urlStr);
+			String query = &quot;{\&quot;method\&quot;: \&quot;getWorkspaceCriterias\&quot;, \&quot;params\&quot;: [\&quot;&quot; + mapId + &quot;\&quot;]}&quot;;
+			// url.s
+			URLConnection connection = new URL(urlStr).openConnection();
+			connection.setDoOutput(true); // Triggers POST.
+			// connection.setRequestProperty(&quot;Accept-Charset&quot;, charset);
+			connection.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json;charset=&quot; + charset);
+			OutputStream output = null;
+			output = connection.getOutputStream();
+			output.write(query.getBytes(charset));
+			// Get the response
+			BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream(), charset)); //
+			String line = &quot;&quot;;
+			if (rd.ready()) {
+				line = rd.readLine();
+			}
+			result = line;
+			return result;
+		} catch(UnknownHostException uke) {
+			System.out.println(&quot;*** [MapServlet] could not load the json data to import from &quot; + urlStr + &quot; message is: &quot; + uke.getMessage());
+			return null;
+			// done();
+		} catch (UnsupportedEncodingException ex) {
+			System.out.println(&quot;*** [MapServlet] Servlet encountered unsupportedEncoding : &quot; + ex.getMessage());
+			return null;
+		} catch (IOException ex) {
+			System.out.println(&quot;*** [MapServlet] Servlet encountered ioException : &quot; + ex.getMessage());
+			return null;
+		}
+	}
 
 	private void toggle(Vector topicIDs, String topicID) {
 		if (topicIDs.contains(topicID)) {
@@ -345,27 +344,27 @@
 		}
 	}
 
-  private String getWorkspaceHomepage(String workspaceId, Session session) {
-    String homepageURL = &quot;&quot;;
-    //
-    BaseTopic homepage = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK, TOPICTYPE_WEBPAGE, 2, true);
-    if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
-    return homepageURL;
-  }
+	private String getWorkspaceHomepage(String workspaceId, Session session) {
+		String homepageURL = &quot;&quot;;
+		//
+		BaseTopic homepage = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_HOMEPAGE_LINK, TOPICTYPE_WEBPAGE, 2, true);
+		if (homepage != null) homepageURL = as.getTopicProperty(homepage, PROPERTY_URL);
+		return homepageURL;
+	}
 
-  private String getWorkspaceImprint(String workspaceId, Session session) {
-    String impressumURL = &quot;&quot;;
-    BaseTopic impressum = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, TOPICTYPE_WEBPAGE, 2, true);
-    if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
-    return impressumURL;
-  }
+	private String getWorkspaceImprint(String workspaceId, Session session) {
+		String impressumURL = &quot;&quot;;
+		BaseTopic impressum = as.getRelatedTopic(workspaceId, KiezAtlas.ASSOCTYPE_IMPRESSUM_LINK, TOPICTYPE_WEBPAGE, 2, true);
+		if (impressum != null) impressumURL = as.getTopicProperty(impressum, PROPERTY_URL);
+		return impressumURL;
+	}
 
-  private String getWorkspaceLogo(String workspaceId, Session session) {
-    String logoURL = &quot;&quot;;
-    BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
-    if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
-    return logoURL;
-  }
+	private String getWorkspaceLogo(String workspaceId, Session session) {
+		String logoURL = &quot;&quot;;
+		BaseTopic logo = as.getRelatedTopic(workspaceId, ASSOCTYPE_ASSOCIATION, TOPICTYPE_IMAGE, 2, true);
+		if (logo != null) logoURL = as.getTopicProperty(logo, PROPERTY_FILE);
+		return logoURL;
+	}
 
 
 
@@ -377,20 +376,20 @@
 
 	// --- Methods to maintain data in the session
 
-  private void initCityMap(Session session) {
-    //
-    BaseTopic map = getCityMap(session);
-    BaseTopic workspace = as.getTopicmapOwner(map.getID());
-    session.setAttribute(&quot;workspace&quot;, workspace);
-    String mapTopics = getMapTopics(map.getID(), workspace.getID(), session);
-    String workspaceCriterias = getKiezCriterias(map.getID(), session);
-    // String workspaceInfos = getWorkspaceInfos(workspaceId, session);
-    session.setAttribute(&quot;mapTopics&quot;, mapTopics);
-    session.setAttribute(&quot;workspaceCriterias&quot;, workspaceCriterias);
-    session.setAttribute(&quot;workspaceImprint&quot;, getWorkspaceImprint(workspace.getID(), session));
-    session.setAttribute(&quot;workspaceHomepage&quot;, getWorkspaceHomepage(workspace.getID(), session));
-    session.setAttribute(&quot;workspaceLogo&quot;, getWorkspaceLogo(workspace.getID(), session));
-  }
+	private void initCityMap(Session session) {
+		//
+		BaseTopic map = getCityMap(session);
+		BaseTopic workspace = as.getTopicmapOwner(map.getID());
+		session.setAttribute(&quot;workspace&quot;, workspace);
+		String mapTopics = getMapTopics(map.getID(), workspace.getID(), session);
+		String workspaceCriterias = getKiezCriterias(map.getID(), session);
+		// String workspaceInfos = getWorkspaceInfos(workspaceId, session);
+		session.setAttribute(&quot;mapTopics&quot;, mapTopics);
+		session.setAttribute(&quot;workspaceCriterias&quot;, workspaceCriterias);
+		session.setAttribute(&quot;workspaceImprint&quot;, getWorkspaceImprint(workspace.getID(), session));
+		session.setAttribute(&quot;workspaceHomepage&quot;, getWorkspaceHomepage(workspace.getID(), session));
+		session.setAttribute(&quot;workspaceLogo&quot;, getWorkspaceLogo(workspace.getID(), session));
+	}
 
 	private void setCityMap(BaseTopic map, Session session) {
 		String mapImage = as.getCorporateWebBaseURL() + FILESERVER_BACKGROUNDS_PATH +
@@ -518,10 +517,10 @@
 		System.out.println(&quot;&gt; \&quot;hotspots\&quot; stored in session: institutions for &quot; + selCats.size() + &quot; categories&quot;);
 	}
 
-    /**
-     * nearly the same to setCategoryHotspots, except that it
-     * takes a catID as an argument and returns it index in the enumeration
-     */
+	/**
+	 * nearly the same to setCategoryHotspots, except that it
+	 * takes a catID as an argument and returns it index in the enumeration
+	 */
 	private int setSearchedCategoryHotspots(Session session, String catId) {
 		String mapID = getCityMap(session).getID();
 		String instTypeID = getInstitutionType(session).getID();
@@ -530,11 +529,11 @@
 		Vector hotspots = new Vector();
 		Vector cluster = new Vector();
 		Enumeration e = selCats.elements();
-        int catIndex = 0;
-        int finalCatIndex = 0;
+		int catIndex = 0;
+		int finalCatIndex = 0;
 		while (e.hasMoreElements()) {
 			String catID = (String) e.nextElement();
-            if (catId == catID) { finalCatIndex = catIndex; };
+			if (catId == catID) { finalCatIndex = catIndex; };
 			Vector presentables = cm.getRelatedViewTopics(mapID, 1, catID, ASSOCTYPE_ASSOCIATION, instTypeID, 1);
 			String icon;
 			if (getSearchMode(session).equals(&quot;0&quot;)) {	// ### first search criteria uses distinct visualization
@@ -547,13 +546,13 @@
 			}
 			presentables.insertElementAt(as.getCorporateWebBaseURL() + FILESERVER_ICONS_PATH + icon, 0);
 			hotspots.addElement(presentables);
-            catIndex++;
+			catIndex++;
 		}
 		makeCluster(hotspots, cluster);
 		session.setAttribute(&quot;cluster&quot;, cluster);
 		session.setAttribute(&quot;hotspots&quot;, hotspots);
 		System.out.println(&quot;&gt; \&quot;hotspots\&quot; stored in session: institutions for &quot; + selCats.size() + &quot; categories&quot;);
-        return finalCatIndex;
+		return finalCatIndex;
 	}
 
 	// ---
@@ -608,42 +607,40 @@
 					}
 				}
 			}
-			// ### System.out.println(&quot;&gt; \&quot;clusters\&quot;: &quot;+clusters.toString());
 		}
-        //removeClusteredHotspots(hotspots, clusters);
 	}
 
-    /** should remove a presentable from the hotspots vector when part of cluster
-     *  ### implement it the other way around
-     */
-    private void removeClusteredHotspots(Vector hotspots, Vector clusters) {
-        for (int i = 0; i &lt; hotspots.size(); i++) {
-            Vector topics = (Vector) hotspots.get(i);
-            Vector doubled = new Vector();
-            for (int j = 1; j &lt; topics.size(); j++) {
-                PresentableTopic topic = (PresentableTopic) topics.get(j);
-                if (isPartOfCluster(clusters, topic.getID())) {
-                    // topic is visible in cluster
-                    doubled.add(topic);
-                }
-            }
-            topics.removeAll(doubled);
-        }
-    }
+	/** should remove a presentable from the hotspots vector when part of cluster
+	 *  ### implement it the other way around
+	 */
+	private void removeClusteredHotspots(Vector hotspots, Vector clusters) {
+		for (int i = 0; i &lt; hotspots.size(); i++) {
+			Vector topics = (Vector) hotspots.get(i);
+			Vector doubled = new Vector();
+			for (int j = 1; j &lt; topics.size(); j++) {
+				PresentableTopic topic = (PresentableTopic) topics.get(j);
+				if (isPartOfCluster(clusters, topic.getID())) {
+					// topic is visible in cluster
+					doubled.add(topic);
+				}
+			}
+			topics.removeAll(doubled);
+		}
+	}
 
-    private boolean isPartOfCluster(Vector clusters, String topicId) {
-        for (int i = 0; i &lt; clusters.size(); i++) {
-            Cluster object = (Cluster) clusters.get(i);
-            Vector topics = object.getPresentables();
-            for (int j = 0; j &lt; topics.size(); j++) {
-                PresentableTopic topic = (PresentableTopic) topics.get(j);
-                if (topic.getID().equals(topicId)) {
-                    return true;
-                }
-            }
-        }
-        return false;
-    }
+	private boolean isPartOfCluster(Vector clusters, String topicId) {
+		for (int i = 0; i &lt; clusters.size(); i++) {
+			Cluster object = (Cluster) clusters.get(i);
+			Vector topics = object.getPresentables();
+			for (int j = 0; j &lt; topics.size(); j++) {
+				PresentableTopic topic = (PresentableTopic) topics.get(j);
+				if (topic.getID().equals(topicId)) {
+					return true;
+				}
+			}
+		}
+		return false;
+	}
 
 	private Cluster findAndCheckClusters(PresentableTopic currentPT, Vector clusters){
 			for (int c=0; c &lt; clusters.size(); c++) {
@@ -730,34 +727,32 @@
 
 	// ---
 
-  private Hashtable parseRequestedPath(String[] elements) {
-    Hashtable result = new Hashtable();
-    for (int i = 0; i &lt; elements.length; i++) {
-      String key = elements[i];
-      try { // ### if one nomen has no attributes, the whole request fails
-        if (key.equals(&quot;layer&quot;)) {
-          result.put(&quot;layer&quot;, elements[i+1]);
-        } else if (key.equals(&quot;p&quot;)) {
-          result.put(&quot;geo&quot;, elements[i+1]);
-        } else if (key.equals(&quot;linkTo&quot;)) {
-          result.put(&quot;linkTo&quot;, elements[i+1]);
-        } else if (key.equals(&quot;categories&quot;)) {
-          result.put(&quot;categories&quot;, elements[i+1]);
-        } else if (key.equals(&quot;criteria&quot;)) {
-          result.put(&quot;criteria&quot;, Integer.parseInt(elements[i+1])-1);
-        } else if (key.equals(&quot;search&quot;)) {
-          result.put(&quot;search&quot;, elements[i+1]);
-        } else {
-          // skip this..
-        }
-      } catch (ArrayIndexOutOfBoundsException ex) {
-        return null;
-      }
-    }
-    // System.out.println(&quot;DEBUG: pathInfo.layer: \&quot;&quot; + result.get(&quot;layer&quot;) + &quot;\&quot; geoObject: \&quot;&quot; + result.get(&quot;geo&quot;) +&quot;\&quot; category: \&quot;&quot; +
-       //  result.get(&quot;category&quot;) + &quot;\&quot; criteria: \&quot;&quot; + result.get(&quot;criteria&quot;) + &quot;\&quot; search: \&quot;&quot; + result.get(&quot;search&quot;) + &quot;\&quot;&quot;);
-    return result;
-  }
+	private Hashtable parseRequestedPath(String[] elements) {
+		Hashtable result = new Hashtable();
+		for (int i = 0; i &lt; elements.length; i++) {
+			String key = elements[i];
+			try { // ### if one nomen has no attributes, the whole request fails
+				if (key.equals(&quot;layer&quot;)) {
+					result.put(&quot;layer&quot;, elements[i+1]);
+				} else if (key.equals(&quot;p&quot;)) {
+					result.put(&quot;geo&quot;, elements[i+1]);
+				} else if (key.equals(&quot;linkTo&quot;)) {
+					result.put(&quot;linkTo&quot;, elements[i+1]);
+				} else if (key.equals(&quot;categories&quot;)) {
+					result.put(&quot;categories&quot;, elements[i+1]);
+				} else if (key.equals(&quot;criteria&quot;)) {
+					result.put(&quot;criteria&quot;, Integer.parseInt(elements[i+1])-1);
+				} else if (key.equals(&quot;search&quot;)) {
+					result.put(&quot;search&quot;, elements[i+1]);
+				} else {
+					// skip this..
+				}
+			} catch (ArrayIndexOutOfBoundsException ex) {
+				return null;
+			}
+		}
+		return result;
+	}
 
 	private BaseTopic getCityMap(Session session) {
 		return (BaseTopic) session.getAttribute(&quot;map&quot;);
@@ -802,7 +797,7 @@
 		return getCurrentCriteria(session).selectedCategoryIDs;
 	}
 
-    private void initSelectedCatAttribute(Session session) {
-        session.setAttribute(&quot;selectedCatId&quot;, null); // necessary for the new cityMap
-    }
+	private void initSelectedCatAttribute(Session session) {
+		session.setAttribute(&quot;selectedCatId&quot;, null); // necessary for the new cityMap
+	}
 }

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000092.html">[Kiezatlas-svn] r108 - in trunk: db/patches pages/be.de	src/de/kiezatlas/deepamehta src/de/kiezatlas/deepamehta/topics
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93">[ date ]</a>
              <a href="thread.html#93">[ thread ]</a>
              <a href="subject.html#93">[ subject ]</a>
              <a href="author.html#93">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiezatlas-svn">More information about the Kiezatlas-svn
mailing list</a><br>
</body></html>
